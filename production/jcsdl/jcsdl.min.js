
(typeof Crypto=="undefined"||!Crypto.util)&&function(){var m=window.Crypto={},o=m.util={rotl:function(h,g){return h<<g|h>>>32-g},rotr:function(h,g){return h<<32-g|h>>>g},endian:function(h){if(h.constructor==Number)return o.rotl(h,8)&16711935|o.rotl(h,24)&4278255360;for(var g=0;g<h.length;g++)h[g]=o.endian(h[g]);return h},randomBytes:function(h){for(var g=[];h>0;h--)g.push(Math.floor(Math.random()*256));return g},bytesToWords:function(h){for(var g=[],i=0,a=0;i<h.length;i++,a+=8)g[a>>>5]|=(h[i]&255)<<24-a%32;return g},wordsToBytes:function(h){for(var g=[],i=0;i<h.length*32;i+=8)g.push(h[i>>>5]>>>24-i%32&255);return g},bytesToHex:function(h){for(var g=[],i=0;i<h.length;i++)g.push((h[i]>>>4).toString(16)),g.push((h[i]&15).toString(16));return g.join("")},hexToBytes:function(h){for(var g=[],i=0;i<h.length;i+=2)g.push(parseInt(h.substr(i,2),16));return g},bytesToBase64:function(h){if(typeof btoa=="function")return btoa(n.bytesToString(h));for(var g=[],i=0;i<h.length;i+=3)for(var a=h[i]<<16|h[i+1]<<8|h[i+2],b=0;b<4;b++)i*8+b*6<=h.length*8?g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-b)&63)):g.push("=");return g.join("")},base64ToBytes:function(h){if(typeof atob=="function")return n.stringToBytes(atob(h));for(var h=h.replace(/[^A-Z0-9+\/]/ig,""),g=[],i=0,a=0;i<h.length;a=++i%4)a!=0&&g.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<a*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i))>>>6-a*2);return g}},m=m.charenc={};m.UTF8={stringToBytes:function(h){return n.stringToBytes(unescape(encodeURIComponent(h)))},bytesToString:function(h){return decodeURIComponent(escape(n.bytesToString(h)))}};var n=m.Binary={stringToBytes:function(h){for(var g=[],i=0;i<h.length;i++)g.push(h.charCodeAt(i)&255);return g},bytesToString:function(h){for(var g=[],i=0;i<h.length;i++)g.push(String.fromCharCode(h[i]));return g.join("")}}}();(function(){var m=Crypto,o=m.util,n=m.charenc,h=n.UTF8,g=n.Binary,i=m.MD5=function(a,b){var h=o.wordsToBytes(i._md5(a));return b&&b.asBytes?h:b&&b.asString?g.bytesToString(h):o.bytesToHex(h)};i._md5=function(a){a.constructor==String&&(a=h.stringToBytes(a));for(var b=o.bytesToWords(a),g=a.length*8,a=1732584193,d=-271733879,e=-1732584194,c=271733878,f=0;f<b.length;f++)b[f]=(b[f]<<8|b[f]>>>24)&16711935|(b[f]<<24|b[f]>>>8)&4278255360;b[g>>>5]|=128<<g%32;b[(g+64>>>9<<4)+14]=g;for(var g=i._ff,j=i._gg,k=i._hh,l=i._ii,f=0;f<b.length;f+=16)var m=a,n=d,p=e,q=c,a=g(a,d,e,c,b[f+0],7,-680876936),c=g(c,a,d,e,b[f+1],12,-389564586),e=g(e,c,a,d,b[f+2],17,606105819),d=g(d,e,c,a,b[f+3],22,-1044525330),a=g(a,d,e,c,b[f+4],7,-176418897),c=g(c,a,d,e,b[f+5],12,1200080426),e=g(e,c,a,d,b[f+6],17,-1473231341),d=g(d,e,c,a,b[f+7],22,-45705983),a=g(a,d,e,c,b[f+8],7,1770035416),c=g(c,a,d,e,b[f+9],12,-1958414417),e=g(e,c,a,d,b[f+10],17,-42063),d=g(d,e,c,a,b[f+11],22,-1990404162),a=g(a,d,e,c,b[f+12],7,1804603682),c=g(c,a,d,e,b[f+13],12,-40341101),e=g(e,c,a,d,b[f+14],17,-1502002290),d=g(d,e,c,a,b[f+15],22,1236535329),a=j(a,d,e,c,b[f+1],5,-165796510),c=j(c,a,d,e,b[f+6],9,-1069501632),e=j(e,c,a,d,b[f+11],14,643717713),d=j(d,e,c,a,b[f+0],20,-373897302),a=j(a,d,e,c,b[f+5],5,-701558691),c=j(c,a,d,e,b[f+10],9,38016083),e=j(e,c,a,d,b[f+15],14,-660478335),d=j(d,e,c,a,b[f+4],20,-405537848),a=j(a,d,e,c,b[f+9],5,568446438),c=j(c,a,d,e,b[f+14],9,-1019803690),e=j(e,c,a,d,b[f+3],14,-187363961),d=j(d,e,c,a,b[f+8],20,1163531501),a=j(a,d,e,c,b[f+13],5,-1444681467),c=j(c,a,d,e,b[f+2],9,-51403784),e=j(e,c,a,d,b[f+7],14,1735328473),d=j(d,e,c,a,b[f+12],20,-1926607734),a=k(a,d,e,c,b[f+5],4,-378558),c=k(c,a,d,e,b[f+8],11,-2022574463),e=k(e,c,a,d,b[f+11],16,1839030562),d=k(d,e,c,a,b[f+14],23,-35309556),a=k(a,d,e,c,b[f+1],4,-1530992060),c=k(c,a,d,e,b[f+4],11,1272893353),e=k(e,c,a,d,b[f+7],16,-155497632),d=k(d,e,c,a,b[f+10],23,-1094730640),a=k(a,d,e,c,b[f+13],4,681279174),c=k(c,a,d,e,b[f+0],11,-358537222),e=k(e,c,a,d,b[f+3],16,-722521979),d=k(d,e,c,a,b[f+6],23,76029189),a=k(a,d,e,c,b[f+9],4,-640364487),c=k(c,a,d,e,b[f+12],11,-421815835),e=k(e,c,a,d,b[f+15],16,530742520),d=k(d,e,c,a,b[f+2],23,-995338651),a=l(a,d,e,c,b[f+0],6,-198630844),c=l(c,a,d,e,b[f+7],10,1126891415),e=l(e,c,a,d,b[f+14],15,-1416354905),d=l(d,e,c,a,b[f+5],21,-57434055),a=l(a,d,e,c,b[f+12],6,1700485571),c=l(c,a,d,e,b[f+3],10,-1894986606),e=l(e,c,a,d,b[f+10],15,-1051523),d=l(d,e,c,a,b[f+1],21,-2054922799),a=l(a,d,e,c,b[f+8],6,1873313359),c=l(c,a,d,e,b[f+15],10,-30611744),e=l(e,c,a,d,b[f+6],15,-1560198380),d=l(d,e,c,a,b[f+13],21,1309151649),a=l(a,d,e,c,b[f+4],6,-145523070),c=l(c,a,d,e,b[f+11],10,-1120210379),e=l(e,c,a,d,b[f+2],15,718787259),d=l(d,e,c,a,b[f+9],21,-343485551),a=a+m>>>0,d=d+n>>>0,e=e+p>>>0,c=c+q>>>0;return o.endian([a,d,e,c])};i._ff=function(a,b,g,d,e,c,f){a=a+(b&g|~b&d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._gg=function(a,b,g,d,e,c,f){a=a+(b&d|g&~d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._hh=function(a,b,g,d,e,c,f){a=a+(b^g^d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._ii=function(a,b,g,d,e,c,f){a=a+(g^(b|~d))+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._blocksize=16;i._digestsize=16})();

var JCSDLConfig={targets:{digg:{name:'Digg',fields:{comment:{name:'Comments',fields:{buries:{name:'Buries',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},diggs:{name:'Diggs',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},text:{name:'Text',icon:'content',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},'item-comments':{name:'Comments Count',icon:'comments-count',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},'item-description':{name:'Description',icon:'description',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'item-diggs':{name:'Diggs',icon:'diggs',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},'item-status':{name:'Status',icon:'status',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'item-title':{name:'Title',icon:'title',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'item-topic':{name:'Topic',icon:'topic',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},type:{name:'Type',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},user:{name:'User',fields:{fullname:{name:'Full Name',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},icon:{name:'Icon',icon:'avatar',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},links:{name:'Links',icon:'link',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'username',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},profileviews:{name:'Profile Views',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},registered:{name:'Registered',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}}}},twitter:{name:'Twitter',fields:{domains:{name:'Domains',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},geo:{name:'Location',type:'geo',input:['geo_box','geo_radius','geo_polygon','geo_text'],operators:['geo_box','geo_radius','geo_polygon']},in_reply_to_screen_name:{name:'In Reply To',icon:'inreply',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},links:{name:'Links',icon:'link',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},mentions:{name:'Mentions',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},source:{name:'Source',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},text:{name:'Tweet',icon:'tweet',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},user:{name:'Author',fields:{description:{name:'Description',icon:'user-description',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},followers_count:{name:'Followers Count',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},follower_ratio:{name:'Follower Ratio',type:'float',input:'number',operators:['equals','different','greaterThan','lowerThan']},friends_count:{name:'Friends Count',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},id:{name:'ID',icon:'user-id',type:'int',input:'number',operators:['equals','different','in']},lang:{name:'Language',icon:'language',type:'string',input:'select',operators:['different','in']},listed_count:{name:'Listed Count',type:'int',operators:['equals','different','greaterThan','lowerThan']},location:{name:'Location',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'username',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},profile_age:{name:'Age',icon:'age',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},screen_name:{name:'Screen Name',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},statuses_count:{name:'Statuses Count',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},time_zone:{name:'Time Zone',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},url:{name:'URL',icon:'url',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},place:{name:'Place',fields:{attributes:{name:'Attributes',icon:'placeattrs',type:'string',input:'text',operators:['contains','in','equals','different','substr','contains_any','contains_near','different','regex_partial','regex_exact']},country:{name:'Country',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},country_code:{name:'Country Code',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},full_name:{name:'Full Name',icon:'fullname',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'placename',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},place_type:{name:'Place Type',icon:'type',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},url:{name:'URL',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},retweet:{name:'Retweet',fields:{count:{name:'No. of Retweets',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},domains:{name:'Domains',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},elapsed:{name:'Elapsed',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},links:{name:'Links',icon:'link',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},source:{name:'Source',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},text:{name:'Tweet',icon:'tweet',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},user:null}},retweeted:{name:'Retweeted',fields:{id:{name:'ID',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},mentions:{name:'Mentions',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},source:{name:'Source',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},place:null,user:null}}}},interaction:{name:'All',fields:{content:{name:'Content',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},geo:{name:'Location',type:'geo',input:['geo_box','geo_radius','geo_polygon','geo_text'],operators:['geo_box','geo_radius','geo_polygon']},link:{name:'Link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},sample:{name:'sample',type:'float',input:'slider',operators:['equals','different','greaterThan','lowerThan']},source:{name:'Source',type:'string',input:'text',operaotrs:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},type:{name:'Type',type:'string',input:'select',operators:['in'],options:{twitter:'Twitter',myspace:'MySpace',facebook:'Facebook',digg:'Digg','2ch':'2ch',amazon:'Amazon',youtube:'YouTube',dailymotion:'DailyMotion'}},title:{name:'Title',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},author:{name:'Author',icon:'user',fields:{id:{name:'ID',icon:'user-id',type:'int',input:'text',operators:['equals','different','greaterThan','lowerThan']},avatar:{name:'Avatar',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},link:{name:'Link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'fullname',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},username:{name:'User Name',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}}}},facebook:{name:'Facebook',fields:{application:{name:'Application',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'author-avatar':{name:'Author Avatar',icon:'avatar',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'author-id':{name:'Author ID',icon:'user-id',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'author-link':{name:'Author Link',icon:'link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'author-name':{name:'Author Name',icon:'username',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},caption:{name:'Caption',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'likes-count':{name:'Likes Count',type:'int',input:'number',operators:['equals','different','greaterThan','lowerThan']},'likes-ids':{name:'Likes IDs',type:'string',input:'text',operators:['contains','in','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'likes-names':{name:'Likes Names',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},link:{name:'Link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},message:{name:'Message',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'fullname',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},og:{name:'Open Graph',icon:'opengraph',fields:{by:{name:'By',icon:'og-by',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},description:{name:'Description',icon:'description',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},location:{name:'Location',icon:'location',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},photos:{name:'Photos',icon:'photos',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},title:{name:'Title',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},type:{name:'Type',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},source:{name:'Source',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'to-ids':{name:'To IDs',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},'to-names':{name:'To Names',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},type:{name:'Type',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},myspace:{name:'MySpace',fields:{author:{name:'Author',icon:'user',fields:{avatar:{name:'Avatar',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},id:{name:'ID',icon:'user-id',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},link:{name:'Link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},name:{name:'Name',icon:'fullname',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},username:{name:'User Name',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}},category:{name:'Category',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},content:{name:'Content',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},contenttype:{name:'Content Type',icon:'type',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},geo:{name:'Location',type:'geo',input:['geo_box','geo_radius','geo_polygon','geo_text'],operators:['geo_box','geo_radius','geo_polygon']},link:{name:'Link',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']},verb:{name:'Verb',type:'string',input:'text',operators:['contains','substr','contains_any','contains_near','different','regex_partial','regex_exact']}}}},operators:{contains:{description:'Filter for a word or phrase',code:'contains'},substr:{description:'Filter for a sequence of characters',code:'substr'},contains_any:{description:'Filter for one or more words',code:'contains_any'},contains_near:{description:'Two or more words that occur near each other',code:'contains_near'},exists:{description:'Check whether this data exists',code:'exists'},different:{description:'Is different than the following',code:'!='},equals:{description:'Equals',code:'=='},'in':{description:'Filter for one or more values from a list',code:'in'},greaterThan:{description:'Greater than',code:'>='},lowerThan:{description:'Lower than',code:'<='},regex_partial:{description:'Filter for content that contains text represented in a regular expression. The text can appear anywhere within the target you select.',code:'regex_partial'},regex_exact:{description:'Filter for content that contains text represented in a regular expression. The regular expression must match the entire content of the target you choose.',code:'regex_exact'},geo_box:{description:'Filter for content originating from geographical locations within a bounding box',code:'geo_box'},geo_radius:{description:'Filter for posts originating inside a circle',code:'geo_radius'},geo_polygon:{description:'Filter for content originating from geographical locations defined by a polygon with up to 32 vertices',code:'geo_polygon'}}};JCSDLConfig.targets.twitter.fields.retweet.fields.user=JCSDLConfig.targets.twitter.fields.user;JCSDLConfig.targets.twitter.fields.retweeted.fields.place=JCSDLConfig.targets.twitter.fields.place;JCSDLConfig.targets.twitter.fields.retweeted.fields.user=JCSDLConfig.targets.twitter.fields.user;

var JCSDLGuiTemplates={container:$('<div class="jcsdl-container" />'),editor:$(['<div class="jcsdl-mainview">','<div class="jcsdl-header">','<h3>Filters</h3>','<div class="jcsdl-mainview-mode">','<span class="jcsdl-label">View as:</span>','<div class="jcsdl-bordered jcsdl-mainview-mode-options">','<a href="#" class="jcsdl-mainview-mode-option jcsdl-expanded active" data-mode="expanded"></a>','<a href="#" class="jcsdl-mainview-mode-option jcsdl-collapsed" data-mode="collapsed"></a>','</div>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto"></div>','Create New Filter','</a>','</div>','</div>','<div class="jcsdl-filters-logic">','<label class="jcsdl-filters-logic-option jcsdl-and">','<input type="radio" name="logic" value="AND" checked />','ALL of the following','</label>','<label class="jcsdl-filters-logic-option jcsdl-or">','<input type="radio" name="logic" value="OR" />','ANY of the following','</label>','</div>','<div class="jcsdl-filters-list expanded">','</div>','<div class="jcsdl-footer">','<div class="jcsdl-actions">','<a href="#" class="jcsdl-button jcsdl-editor-save">Save and Preview</a>','<a href="#" class="jcsdl-button jcsdl-editor-cancel">Cancel</a>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto"></div>','Create New Filter','</a>','</div>','</div>','</div>'].join('')),filter:$(['<div class="jcsdl-filter">','<div class="jcsdl-filter-description">','<div class="jcsdl-filter-info target"></div>','<div class="jcsdl-filter-info field"></div>','<div class="jcsdl-filter-info operator"></div>','<div class="jcsdl-filter-info jcsdl-bordered value"></div>','</div>','<div class="jcsdl-filter-options">','<a href="#" class="edit">Edit</a>','<span>/</span>','<a href="#" class="delete">Delete</a>','</div>','</div>'].join('')),filterTarget:$('<div class="jcsdl-filter-target jcsdl-icon target" />'),filterField:$('<div class="jcsdl-filter-field jcsdl-icon field" />'),filterOperator:$('<div class="jcsdl-filter-operator" />'),filterValue:$('<div class="jcsdl-filter-value" />'),filterEditor:$(['<div class="jcsdl-filter-editor">','<div class="jcsdl-steps">','</div>','<div class="jcsdl-footer">','<a href="#" class="jcsdl-button jcsdl-filter-save">Save and Preview</a>','<span style="display: none;">or</span> <a href="#" class="jcsdl-filter-cancel">cancel</a>','</div>','</div>'].join('')),step:$('<div class="jcsdl-step" />'),target:$(['<div class="jcsdl-filter-target-wrap">','<a href="#" class="jcsdl-carousel-scroll left"></a>','<a href="#" class="jcsdl-carousel-scroll right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target jcsdl-carousel" />','</div>','</div>'].join('')),targetOption:$('<a href="#" class="jcsdl-icon target jcsdl-carousel-item"></a>'),field:$(['<div class="jcsdl-filter-target-field-wrap">','<a href="#" class="jcsdl-carousel-scroll left"></a>','<a href="#" class="jcsdl-carousel-scroll right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target-field jcsdl-carousel" />','</div>','</div>'].join('')),fieldOption:$('<a href="#" class="jcsdl-icon field jcsdl-carousel-item"></a>'),valueInput:$(['<div class="jcsdl-filter-value-input">','<div class="jcsdl-filter-value-input-operators"></div>','<div class="jcsdl-filter-value-input-field"></div>','</div>'].join('')),operatorSelect:$(['<div class="jcsdl-operator-select">','<label><input type="radio" name="operator" /></label>','</div>'].join('')),valueInput_text:$(['<div class="jcsdl-input-text">','<input type="text" placeholder="Type your desired value" />','</div>'].join('')),valueInput_number:$(['<div class="jcsdl-input-number">','<input type="text" placeholder="e.g. 3.14" />','</div>'].join('')),valueInput_select:$(['<div class="jcsdl-input-select">','</div>'].join('')),valueInput_select_option:$(['<div class="jcsdl-input-select-option">','<label>','<input type="checkbox" name="selectvalue[]" />','<span />','</label>','</div>'].join(''))};

var JCSDL=function(gui){var self=this;var gui=gui;this.parseJCSDL=function(code){var lines=code.split("\n");var masterLine=lines.shift();var endLine=lines.pop();if(!verifyJCSDL(masterLine,lines)){error('The given JCSDL did not verify!',code);return false;}
var logic=masterLine.split(' ')[3];var filters=[];while(lines.length>0){var jcsdlDescription=lines.shift();var csdl=lines.shift();var jcsdlEnd=lines.shift();lines.shift();jcsdlDescription=jcsdlDescription.split(' ');var jcsdlHash=jcsdlDescription[2];var jcsdlCode=jcsdlDescription[3];if(!verifyJCSDLFilter(jcsdlHash,csdl)){error('The given JCSDL Filter code did not verify!',csdl,code);return false;}
var filter=self.filterFromJCSDL(jcsdlCode,csdl);filters.push(filter);}
return{filters:filters,logic:logic};};this.filterFromJCSDL=function(jcsdlCode,csdl){jcsdlCode=jcsdlCode.split(',');var fieldPath=jcsdlCode.shift().split('.');var target=fieldPath.shift();var fieldInfo=self.getFieldInfo(target,fieldPath);if(fieldInfo===false)return false;var operator=jcsdlCode.shift();var range=jcsdlCode.shift().split('-');var value=csdl.substr(range[0],range[1]);value=valueFromCSDL(fieldInfo,value);var filter=self.createFilter(target,fieldPath,operator,value);return filter;};this.getJCSDLForFilters=function(filters,logic){var logic=(logic)?logic:'AND';logic=(logic=='AND'||logic=='OR')?logic:'AND';var filterCodes=[];$.each(filters,function(i,filter){var parsedFilter=self.filterToCSDL(filter);if(!parsedFilter)return true;filterCodes.push(parsedFilter);});var output=filterCodes.join("\n"+logic+"\n");var hash=encodeJCSDL(output,logic);output='// JCSDL_MASTER '+hash+' '+logic+"\n"+output+"\n// JCSDL_MASTER_END";return output;};this.filterToCSDL=function(filter){var fieldInfo=self.getFieldInfo(filter.target,filter.fieldPath);if(fieldInfo===false)return false;var value=valueToCSDL(filter.value,fieldInfo);if(value===false)return false;var field=fieldToCSDL(filter.fieldPath);if(field===false)return false;var operatorCode=self.getOperatorCode(filter.operator);if(operatorCode===false)return false;var csdl=filter.target+'.'+field.replace('-','.')+' '+operatorCode+' ';var valueStart=(fieldInfo.type=='string')?csdl.length+1:csdl.length;var valueLength=(fieldInfo.type=='string')?value.length-2:value.length;csdl=csdl+value;var jcsdlSyntax=filter.target+'.'+field+','+filter.operator+','+valueStart+'-'+valueLength;var hash=encodeJCSDLFilter(csdl);var jcsdl_start='// JCSDL_START '+hash+' '+jcsdlSyntax;var jcsdl_end='// JCSDL_END';return jcsdl_start+"\n"+csdl+"\n"+jcsdl_end;};var encodeJCSDL=function(output,logic){var hash=Crypto.MD5(logic+"\n"+output);return hash;};var verifyJCSDL=function(masterLine,lines){var input=lines.join("\n");var masterInfo=masterLine.split(' ');var logic=masterInfo[3];var hash=masterInfo[2];var jcsdlHash=encodeJCSDL(input,logic);return(hash==jcsdlHash);};var encodeJCSDLFilter=function(csdl){var hash=Crypto.MD5(csdl);return hash;};var verifyJCSDLFilter=function(hash,csdl){var csdlHash=encodeJCSDLFilter(csdl);return(hash==csdlHash);};var fieldToCSDL=function(fieldPath){return fieldPath.join('.');};var valueToCSDL=function(value,fieldInfo){var parsedValue='';if(fieldInfo.type=='int'){if(isNaN(value)){error('This field value is suppose to be a Number, String given.',value,fieldInfo);return false;}
parsedValue=value;}else{parsedValue='"'+value.escapeCsdl()+'"';}
return parsedValue;};var valueFromCSDL=function(fieldInfo,value){if(fieldInfo.type=='int'){return value;}else{return value.unescapeCsdl();}};var error=function(message,code){gui.showError.apply(gui,arguments);};this.createFilter=function(target,fieldPath,operator,value){var filter={target:target,fieldPath:fieldPath,operator:operator,value:value}
return filter;};this.getOperatorCode=function(operatorName){return JCSDLConfig.operators[operatorName].code;};this.getTargetInfo=function(target){if(typeof(JCSDLConfig.targets[target])!=='undefined'){return JCSDLConfig.targets[target];}
error('Such target does not exist!',target);return false;};this.getFieldInfo=function(target,fieldPath){var field=JCSDLConfig.targets[target];if(typeof(field)=='undefined'){error('Such target does not exist!',target);return false;}
$.each(fieldPath,function(i,fieldName){if(typeof(field.fields)!=='undefined'){if(typeof(field.fields[fieldName])!=='undefined'){field=field.fields[fieldName];}else{error('Invalid path to a field a!',target,fieldPath,field);field=false;return false;}}else{error('Invalid path to a field b!',target,fieldPath,field);field=false;return false;}});return field;};};

var JCSDLGui=function(el,config){var self=this;var $el=$(el);if($el.length==0)return false;self.$container=$();var jcsdl=new JCSDL(this);this.config=$.extend(true,{animationSpeed:200,displayCancelButton:true,save:function(code){},cancel:function(){self.$container.hide();}},config);this.logic='AND';this.filters=[];this.currentFilterIndex=null;this.currentFilterSteps=[];this.currentFilterTarget=null;this.currentFilterFieldsPath=[];this.$mainView=$();this.$filtersList=$();this.$currentFilterView=$();this.templates=JCSDLGuiTemplates;this.init=function(){self.logic='AND';self.filters=[];self.currentFilterIndex=null;self.currentFilterSteps=[];self.currentFilterTarget=null;self.currentFilterFieldsPath=[];self.$currentFilterView=$();self.$currentFilterStepsView=$();self.$mainView=self.getTemplate('editor');self.$filtersList=self.$mainView.find('.jcsdl-filters-list');self.$container=self.getTemplate('container');self.$container.html(self.$mainView);$el.html(self.$container);if(!self.config.displayCancelButton){self.$mainView.find('.jcsdl-editor-cancel').hide();}
self.$mainView.find('.jcsdl-filters-logic input[name="logic"]').change(function(ev){self.logic=$(this).val();});self.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').click(function(ev){ev.preventDefault();ev.target.blur();var $this=$(this);self.$filtersList.removeClass('expanded collapsed');self.$filtersList.addClass($this.data('mode'));self.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').removeClass('active');$this.addClass('active');});self.$mainView.find('.jcsdl-add-filter').click(function(ev){ev.preventDefault();ev.target.blur();self.showFilterEditor();});self.$mainView.find('.jcsdl-editor-save').bind('click.jcsdl',function(ev){ev.preventDefault();ev.target.blur();self.returnJCSDL();});self.$mainView.find('.jcsdl-editor-cancel').bind('click.jcsdl',function(ev){ev.preventDefault();ev.target.blur();self.config.cancel.apply(self,[]);});};this.loadJCSDL=function(code){this.init();var parsed=jcsdl.parseJCSDL(code);if(parsed===false){self.showError('Invalid JCSDL input!',code);return;}
self.logic=(parsed.logic=='AND')?'AND':'OR';self.filters=parsed.filters;self.$mainView.find('.jcsdl-filters-logic input[name="logic"][value="'+self.logic+'"]').click();$.each(self.filters,function(i,filter){var $filterRow=createFilterRow(filter);$filterRow.appendTo(self.$filtersList);});self.$mainView.find('.jcsdl-editor-cancel').show();};this.returnJCSDL=function(){var code=jcsdl.getJCSDLForFilters(self.filters,self.logic);self.config.save.apply(self,[code]);};this.showFilterEditor=function(filter,filterIndex){self.$mainView.hide();self.$currentFilterView=self.getTemplate('filterEditor');self.$currentFilterStepsView=self.$currentFilterView.find('.jcsdl-steps');self.$currentFilterView.appendTo(self.$container);self.$currentFilterView.show();self.initFilterEditor();if(typeof(filter)!=='undefined'&&filter){self.currentFilterIndex=filterIndex;var fieldInfo=jcsdl.getFieldInfo(filter.target,filter.fieldPath);self.$currentFilterView.find('.jcsdl-filter-target .target-'+filter.target).click();$.each(filter.fieldPath,function(i,field){var $fieldView=self.$currentFilterView.find('.jcsdl-filter-target-field:last');$fieldView.find('.field-'+field).click();});self.$currentFilterView.find('input[value="'+filter.operator+'"]').click();var $valueInputView=self.$currentFilterView.find('.jcsdl-filter-value-input-field');setValueForField($valueInputView,fieldInfo,filter.value);}};this.initFilterEditor=function(filter,filterIndex){var $targetSelectView=createTargetSelectView();self.addFilterStep('target',$targetSelectView);self.$currentFilterView.find('.jcsdl-filter-save').hide();self.$currentFilterView.find('.jcsdl-footer span').hide();self.$currentFilterView.find('.jcsdl-filter-save').click(function(ev){ev.preventDefault();ev.target.blur();self.didSubmitFilter();});self.$currentFilterView.find('.jcsdl-filter-cancel').click(function(ev){ev.preventDefault();ev.target.blur();self.hideFilterEditor();});};this.hideFilterEditor=function(){self.currentFilterIndex=null;self.currentFilterSteps=[];self.currentFilterTarget=null;self.currentFilterFieldsPath=[];self.$currentFilterView.fadeOut(self.config.animationSpeed,function(){self.$currentFilterView.remove();self.$mainView.show();});};this.deleteFilter=function(index){self.$filtersList.find('.jcsdl-filter').eq(index).remove();self.filters.splice(index,1);};this.addFilterStep=function(stepName,$view){var $stepView=self.getTemplate('step');$stepView.html($view);var stepNumber=self.currentFilterSteps.length;$stepView.data('number',stepNumber);$stepView.addClass('jcsdl-filter-step-number-'+stepNumber);$stepView.data('name',stepName);$stepView.addClass('jcsdl-filter-step-'+stepName);$stepView.appendTo(self.$currentFilterStepsView);if(stepName=='target'){buildCarousel($stepView,function(){self.didSelectTarget($(this).data('name'));});}
if(stepName=='field'){self.$currentFilterView.addClass('has-fields');self.$currentFilterStepsView.find('.jcsdl-filter-step-field').removeClass('last');$stepView.addClass('last');buildCarousel($stepView,function(){self.didSelectField($(this).data('name'),$view);});}
if(stepName=='value'){self.$currentFilterView.addClass('has-value');}
$stepView.hide().slideDown(self.config.animationSpeed);self.currentFilterSteps.push($stepView);};this.removeFilterStepsAfterPosition=function(position){self.$currentFilterView.removeClass('has-value');var $theStep=self.$currentFilterStepsView.find('.jcsdl-step').eq(position);if($theStep.hasClass('jcsdl-filter-step-field')){$theStep.addClass('last');}
var steps=self.currentFilterSteps.splice(position+1,self.currentFilterSteps.length-position);$.each(steps,function(i,$step){$($step).remove();});};this.didSelectTarget=function(targetName){if(typeof(JCSDLConfig.targets[targetName])=='undefined')return false;self.currentFilterTarget=targetName;self.currentFilterFieldsPath=[];self.removeFilterStepsAfterPosition(0);var target=JCSDLConfig.targets[targetName];var $fieldView=createFieldSelectionView(target.fields);self.addFilterStep('field',$fieldView);};this.didSelectField=function(fieldName,$fieldView){var fieldPosition=$fieldView.data('position');self.currentFilterFieldsPath.splice(fieldPosition,self.currentFilterFieldsPath.length-fieldPosition);var field=getFieldInfoAtCurrentPath(fieldName);if(field==false)return;self.removeFilterStepsAfterPosition($fieldView.closest('.jcsdl-step').data('number'));self.currentFilterFieldsPath.push(fieldName);if(typeof(field.fields)!=='undefined'){var $fieldView=createFieldSelectionView(field.fields);self.addFilterStep('field',$fieldView);return;}
var $valueView=createValueInputView(field);self.addFilterStep('value',$valueView);self.$currentFilterView.find('.jcsdl-filter-save').fadeIn(self.config.animationSpeed);self.$currentFilterView.find('.jcsdl-footer span').show();};this.didSubmitFilter=function(){var $selectedOperator=self.$currentFilterView.find('.jcsdl-filter-value-input-operators [name="operator"]:checked');if($selectedOperator.length==0){self.showError('You need to select an operator!');return;}
var $valueView=self.$currentFilterView.find('.jcsdl-filter-value-input-field');var value=getValueFromField($valueView,getFieldInfoAtCurrentPath());if(value.length==0){self.showError('You need to specify a value!');return;}
var filter=jcsdl.createFilter(self.currentFilterTarget,self.currentFilterFieldsPath,$selectedOperator.val(),value);var $filterRow=createFilterRow(filter);if(self.currentFilterIndex!==null){self.$filtersList.find('.jcsdl-filter').eq(self.currentFilterIndex).replaceWith($filterRow);self.filters[self.currentFilterIndex]=filter;}else{$filterRow.appendTo(self.$filtersList);self.filters.push(filter);}
self.hideFilterEditor();};this.showError=function(message,code){alert(message+"\n\n##################\n\n"+code+"\n\n#####\n\n See console for more info.");console.error(message,arguments);};var createFilterRow=function(filter){var $filterRow=self.getTemplate('filter');var $target=self.getTemplate('filterTarget');var targetInfo=jcsdl.getTargetInfo(filter.target);$target.addClass('selected target-'+filter.target).html(targetInfo.name);$filterRow.find('.target').html($target);var currentPath=[];$.each(filter.fieldPath,function(i,field){currentPath.push(field);var $field=self.getTemplate('filterField');var fieldInfo=jcsdl.getFieldInfo(filter.target,currentPath);$field.addClass('selected icon-'+getIconForField(field,fieldInfo));$field.html(fieldInfo.name);$filterRow.find('.jcsdl-filter-info.field').append($field);});var $operator=self.getTemplate('filterOperator');$operator.addClass('operator-'+filter.operator).html(jcsdl.getOperatorCode(filter.operator).escapeHtml());$filterRow.find('.operator').html($operator);var $value=self.getTemplate('filterValue');$value.html(filter.value.escapeHtml());$filterRow.find('.value').html($value);$filterRow.data('filter',filter);$filterRow.find('.edit').click(function(ev){ev.preventDefault();ev.target.blur();var index=self.getFilterIndexByElement($filterRow);self.showFilterEditor(filter,index);});$filterRow.find('.delete').click(function(ev){ev.preventDefault();ev.target.blur();var index=self.getFilterIndexByElement($filterRow);self.deleteFilter(index);});return $filterRow;};var createTargetSelectView=function(){var $targetSelectView=self.getTemplate('target');var $targetSelect=$targetSelectView.find('.jcsdl-filter-target');$.each(JCSDLConfig.targets,function(name,target){var $targetView=createOptionForTarget(name,target);$targetView.appendTo($targetSelect);});return $targetSelectView;};var createOptionForTarget=function(name,target){var $option=self.getTemplate('targetOption');$option.data('name',name);$option.data('target',target);$option.addClass('target-'+name);return $option;};var createFieldSelectionView=function(fields){var $fieldView=self.getTemplate('field');var fieldPosition=self.currentFilterFieldsPath.length;$fieldView.data('position',fieldPosition);$fieldView.addClass('field-select-'+fieldPosition);var $fieldSelect=$fieldView.find('.jcsdl-filter-target-field');$.each(fields,function(name,field){var $fieldView=createOptionForField(name,field);$fieldView.appendTo($fieldSelect);});return $fieldView;};var createOptionForField=function(name,fieldInfo){var $option=self.getTemplate('fieldOption');$option.data('name',name);$option.data('field',fieldInfo);$option.html(fieldInfo.name);$option.addClass('icon-'+getIconForField(name,fieldInfo));$option.addClass('field-'+name);return $option;};var buildCarousel=function($step,selectCallback,expand){$step.jcsdlCarousel({select:selectCallback,expand:expand});};var createOperatorSelectView=function(operatorName){var operator=JCSDLConfig.operators[operatorName];if(typeof(operator)=='undefined')return $();var $operatorView=self.getTemplate('operatorSelect');$operatorView.find('input').val(operatorName);$operatorView.find('label').append(operator.description);return $operatorView;};var createValueInputView=function(field){var $valueView=self.getTemplate('valueInput');if(typeof(fieldTypes[field.input])=='undefined')return $valueView;var $inputView=fieldTypes[field.input].init.apply($(),[field]);$valueView.find('.jcsdl-filter-value-input-field').data('inputType',field.input).html($inputView);;var $operatorsListView=$valueView.find('.jcsdl-filter-value-input-operators');$.each(field.operators,function(i,operator){var $operatorView=createOperatorSelectView(operator);$operatorsListView.append($operatorView);});if(field.operators.length==1){$operatorsListView.find('.jcsdl-operator-select:first input').click();$operatorsListView.hide();}
return $valueView;};var setValueForField=function($view,fieldInfo,value){var inputType=$view.data('inputType');if(typeof(fieldTypes[inputType])=='undefined')return false;fieldTypes[inputType].setValue.apply($view,[fieldInfo,value]);return true;};var getValueFromField=function($view,fieldInfo){var inputType=$view.data('inputType');if(typeof(fieldTypes[inputType])=='undefined')return'';return fieldTypes[inputType].getValue.apply($view,[fieldInfo]);};var fieldTypes={text:{init:function(fieldInfo){var $view=self.getTemplate('valueInput_text');return $view;},setValue:function(fieldInfo,value){this.find('input[type=text]').val(value);},getValue:function(fieldInfo){return this.find('input[type=text]').val();}},number:{init:function(fieldInfo){var $view=self.getTemplate('valueInput_number');$view.find('input[type=text]').keydown(function(ev){if((ev.which==190||ev.which==110)&&($(this).val().indexOf('.')>=0)){ev.preventDefault();return;}
if(ev.shiftKey||ev.altKey){ev.preventDefault();return;}else if(ev.which==46||ev.which==8||ev.which==9||ev.which==27||ev.which==190||ev.which==110||(ev.which==65&&ev.ctrlKey===true)||(ev.which>=35&&ev.which<=39)){return;}else{if((ev.which<48||ev.which>57)&&(ev.which<96||ev.which>105)){ev.preventDefault();}}});return $view;},setValue:function(fieldInfo,value){this.find('input[type=text]').val(value);},getValue:function(fieldInfo){return this.find('input[type=text]').val();}},select:{init:function(fieldInfo){var $view=self.getTemplate('valueInput_select');if(typeof(fieldInfo.options)!=='undefined'){$.each(fieldInfo.options,function(name,label){var $optionView=self.getTemplate('valueInput_select_option');$optionView.find('input').val(name);$optionView.find('label span').html(label);$optionView.appendTo($view);});}
return $view;},setValue:function(fieldInfo,value){var values=value.split(',');var $view=this;$.each(values,function(i,name){$view.find('input[value="'+name+'"]').attr('checked',true);});},getValue:function(fieldInfo){var values=[];this.find('input:checked').each(function(i,option){values.push($(option).val());});return values.join(',');}}};var getFieldInfoAtCurrentPath=function(newFieldName){var fieldsPath=self.currentFilterFieldsPath.slice(0);if(typeof(newFieldName)=='string'){fieldsPath.push(newFieldName);}
return jcsdl.getFieldInfo(self.currentFilterTarget,fieldsPath);};var getIconForField=function(field,fieldInfo){var icon=(typeof(fieldInfo.icon)!=='undefined')?fieldInfo.icon:field;return icon;}
this.getTemplate=function(name){if(typeof(self.templates[name])!=='undefined'){return self.templates[name].clone();}
return $();};this.getFilterIndexByElement=function($filterRow){return self.$filtersList.find('.jcsdl-filter').index($filterRow);};this.init();};(function($){function JCSDLCarousel($el,options){var self=this;this.select=options.select;this.$carousel=$el.find('.jcsdl-carousel');this.$carouselWrap=this.$carousel.closest('.jcsdl-carousel-wrap');this.$carouselItems=this.$carousel.find('.jcsdl-carousel-item');this.$exampleItem=this.$carouselItems.eq(0);this.$scrollLeft=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.left');this.$scrollRight=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.right');this.itemsCount=this.$carouselItems.length;this.itemWidth=this.$exampleItem.outerWidth(true);this.itemMargin=parseInt(this.$exampleItem.css('marginRight'));this.margin=this.calculateCenterMargin();var $selected=this.$carouselItems.filter('.selected');this.selectedIndex=($selected.length==1)?$selected.prevAll().length:Math.floor(this.itemsCount/2);this.$carouselWrap.css({maxWidth:this.calculateWrapWidth(),height:this.$exampleItem.outerHeight(true)});this.$carousel.css({position:'relative',left:this.calculateCurrentPosition(),width:this.itemWidth*this.itemsCount,height:this.$exampleItem.outerHeight(true)});this.changePosition(0,!options.expand);this.$carouselWrap.siblings('.jcsdl-carousel-scroll').click(function(ev){ev.preventDefault();ev.target.blur();var $scroll=$(this);if($scroll.hasClass('inactive'))return;var changeIndex=$scroll.is(self.$scrollLeft)?-1:1;self.selectedIndex=self.selectedIndex+changeIndex;self.changePosition(options.speed);});this.$carouselItems.click(function(ev){ev.preventDefault();ev.target.blur();self.selectedIndex=$(this).prevAll().length;self.changePosition(options.speed);});var resizeTimeout=null;$(window).resize(function(ev){clearTimeout(resizeTimeout);resizeTimeout=setTimeout(function(){var wrapWidth=self.calculateWrapWidth();self.$carouselWrap.css({maxWidth:wrapWidth});self.calculateCenterMargin();self.changePosition(0,true);},30);});}
JCSDLCarousel.prototype={calculateWrapWidth:function(){return this.$carouselWrap.closest('.jcsdl-step').width()-this.$scrollLeft.outerWidth(true)-this.$scrollRight.outerWidth(true);},calculateCenterMargin:function(){this.margin=(this.$carouselWrap.width()-this.itemWidth+this.itemMargin)/2;return this.margin;},calculateCurrentPosition:function(){return-1*this.itemWidth*this.selectedIndex+this.margin;},toggleScrollButtons:function(){this.$scrollLeft.removeClass('inactive');this.$scrollRight.removeClass('inactive');if(this.selectedIndex==0)this.$scrollLeft.addClass('inactive');if(this.selectedIndex+1==this.itemsCount)this.$scrollRight.addClass('inactive');},getSelectedItem:function(){return this.$carouselItems.eq(this.selectedIndex);},changePosition:function(speed,dontExpand){this.$carousel.animate({left:this.calculateCurrentPosition()},speed);var $selectedItem=this.getSelectedItem();this.$carouselItems.removeClass('selected');$selectedItem.addClass('selected');this.toggleScrollButtons();if(!dontExpand&&typeof(this.select)=='function'){this.select.apply($selectedItem);}}};$.fn.jcsdlCarousel=function(options){options=$.extend({},{select:function(){},expand:false,speed:200},options);function getJCSDLCarousel($el){var carousel=$el.data('jcsdlCarousel');if(!carousel){carousel=new JCSDLCarousel($el,options);$el.data('jcsdlCarousel',carousel);}
return carousel;}
this.each(function(){getJCSDLCarousel($(this));});return this;};})(window.jQuery);$.extend(String.prototype,{escapeHtml:function(){str=this.valueOf().replace(/&/g,'&amp;');str=str.replace(/</g,'&lt;');str=str.replace(/>/g,'&gt;');str=str.replace(/"/g,'&quot;');return str;},unescapeHtml:function(){str=this.valueOf().replace(/&amp;/g,'&');str=str.replace(/&lt;/g,'<');str=str.replace(/&gt;/g,'>');str=str.replace(/&quot;/g,'"');return str;},escapeCsdl:function(){return this.valueOf().replace(/"/g,'\\"');},unescapeCsdl:function(){return this.valueOf().replace(/\\"/g,'"');}});
