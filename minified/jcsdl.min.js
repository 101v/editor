;JCSDL={};(function(window,undefined){JCSDL.Loader={compnts:[],loaded:[],isLoaded:false,addComponent:function(f){if(typeof f=='function'){JCSDL.Loader.compnts.push(f);}},addLoaded:function(f){if(typeof f=='function'){JCSDL.Loader.loaded.push(f);}},load:function(){var $=window.jQuery;$.each(JCSDL.Loader.compnts,function(){this.apply(JCSDL,[$]);});$.each(JCSDL.Loader.loaded,function(){this.apply(JCSDL,[]);});JCSDL.Loader.isLoaded=true;},timeout:function(nc){setTimeout(function(){if(window.jQuery){if(nc)window.jQuery.noConflict();JCSDL.Loader.load();}else{JCSDL.Loader.timeout();}},100);}};JCSDL.onLoad=function(f){if(typeof f!=='function')return false;if(JCSDL.Loader.isLoaded){f.apply(JCSDL,[]);}else{JCSDL.Loader.addLoaded(f);}};})(window);

(typeof Crypto=="undefined"||!Crypto.util)&&function(){var m=window.Crypto={},o=m.util={rotl:function(h,g){return h<<g|h>>>32-g},rotr:function(h,g){return h<<32-g|h>>>g},endian:function(h){if(h.constructor==Number)return o.rotl(h,8)&16711935|o.rotl(h,24)&4278255360;for(var g=0;g<h.length;g++)h[g]=o.endian(h[g]);return h},randomBytes:function(h){for(var g=[];h>0;h--)g.push(Math.floor(Math.random()*256));return g},bytesToWords:function(h){for(var g=[],i=0,a=0;i<h.length;i++,a+=8)g[a>>>5]|=(h[i]&255)<<24-a%32;return g},wordsToBytes:function(h){for(var g=[],i=0;i<h.length*32;i+=8)g.push(h[i>>>5]>>>24-i%32&255);return g},bytesToHex:function(h){for(var g=[],i=0;i<h.length;i++)g.push((h[i]>>>4).toString(16)),g.push((h[i]&15).toString(16));return g.join("")},hexToBytes:function(h){for(var g=[],i=0;i<h.length;i+=2)g.push(parseInt(h.substr(i,2),16));return g},bytesToBase64:function(h){if(typeof btoa=="function")return btoa(n.bytesToString(h));for(var g=[],i=0;i<h.length;i+=3)for(var a=h[i]<<16|h[i+1]<<8|h[i+2],b=0;b<4;b++)i*8+b*6<=h.length*8?g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-b)&63)):g.push("=");return g.join("")},base64ToBytes:function(h){if(typeof atob=="function")return n.stringToBytes(atob(h));for(var h=h.replace(/[^A-Z0-9+\/]/ig,""),g=[],i=0,a=0;i<h.length;a=++i%4)a!=0&&g.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<a*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h.charAt(i))>>>6-a*2);return g}},m=m.charenc={};m.UTF8={stringToBytes:function(h){return n.stringToBytes(unescape(encodeURIComponent(h)))},bytesToString:function(h){return decodeURIComponent(escape(n.bytesToString(h)))}};var n=m.Binary={stringToBytes:function(h){for(var g=[],i=0;i<h.length;i++)g.push(h.charCodeAt(i)&255);return g},bytesToString:function(h){for(var g=[],i=0;i<h.length;i++)g.push(String.fromCharCode(h[i]));return g.join("")}}}();(function(){var m=Crypto,o=m.util,n=m.charenc,h=n.UTF8,g=n.Binary,i=m.MD5=function(a,b){var h=o.wordsToBytes(i._md5(a));return b&&b.asBytes?h:b&&b.asString?g.bytesToString(h):o.bytesToHex(h)};i._md5=function(a){a.constructor==String&&(a=h.stringToBytes(a));for(var b=o.bytesToWords(a),g=a.length*8,a=1732584193,d=-271733879,e=-1732584194,c=271733878,f=0;f<b.length;f++)b[f]=(b[f]<<8|b[f]>>>24)&16711935|(b[f]<<24|b[f]>>>8)&4278255360;b[g>>>5]|=128<<g%32;b[(g+64>>>9<<4)+14]=g;for(var g=i._ff,j=i._gg,k=i._hh,l=i._ii,f=0;f<b.length;f+=16)var m=a,n=d,p=e,q=c,a=g(a,d,e,c,b[f+0],7,-680876936),c=g(c,a,d,e,b[f+1],12,-389564586),e=g(e,c,a,d,b[f+2],17,606105819),d=g(d,e,c,a,b[f+3],22,-1044525330),a=g(a,d,e,c,b[f+4],7,-176418897),c=g(c,a,d,e,b[f+5],12,1200080426),e=g(e,c,a,d,b[f+6],17,-1473231341),d=g(d,e,c,a,b[f+7],22,-45705983),a=g(a,d,e,c,b[f+8],7,1770035416),c=g(c,a,d,e,b[f+9],12,-1958414417),e=g(e,c,a,d,b[f+10],17,-42063),d=g(d,e,c,a,b[f+11],22,-1990404162),a=g(a,d,e,c,b[f+12],7,1804603682),c=g(c,a,d,e,b[f+13],12,-40341101),e=g(e,c,a,d,b[f+14],17,-1502002290),d=g(d,e,c,a,b[f+15],22,1236535329),a=j(a,d,e,c,b[f+1],5,-165796510),c=j(c,a,d,e,b[f+6],9,-1069501632),e=j(e,c,a,d,b[f+11],14,643717713),d=j(d,e,c,a,b[f+0],20,-373897302),a=j(a,d,e,c,b[f+5],5,-701558691),c=j(c,a,d,e,b[f+10],9,38016083),e=j(e,c,a,d,b[f+15],14,-660478335),d=j(d,e,c,a,b[f+4],20,-405537848),a=j(a,d,e,c,b[f+9],5,568446438),c=j(c,a,d,e,b[f+14],9,-1019803690),e=j(e,c,a,d,b[f+3],14,-187363961),d=j(d,e,c,a,b[f+8],20,1163531501),a=j(a,d,e,c,b[f+13],5,-1444681467),c=j(c,a,d,e,b[f+2],9,-51403784),e=j(e,c,a,d,b[f+7],14,1735328473),d=j(d,e,c,a,b[f+12],20,-1926607734),a=k(a,d,e,c,b[f+5],4,-378558),c=k(c,a,d,e,b[f+8],11,-2022574463),e=k(e,c,a,d,b[f+11],16,1839030562),d=k(d,e,c,a,b[f+14],23,-35309556),a=k(a,d,e,c,b[f+1],4,-1530992060),c=k(c,a,d,e,b[f+4],11,1272893353),e=k(e,c,a,d,b[f+7],16,-155497632),d=k(d,e,c,a,b[f+10],23,-1094730640),a=k(a,d,e,c,b[f+13],4,681279174),c=k(c,a,d,e,b[f+0],11,-358537222),e=k(e,c,a,d,b[f+3],16,-722521979),d=k(d,e,c,a,b[f+6],23,76029189),a=k(a,d,e,c,b[f+9],4,-640364487),c=k(c,a,d,e,b[f+12],11,-421815835),e=k(e,c,a,d,b[f+15],16,530742520),d=k(d,e,c,a,b[f+2],23,-995338651),a=l(a,d,e,c,b[f+0],6,-198630844),c=l(c,a,d,e,b[f+7],10,1126891415),e=l(e,c,a,d,b[f+14],15,-1416354905),d=l(d,e,c,a,b[f+5],21,-57434055),a=l(a,d,e,c,b[f+12],6,1700485571),c=l(c,a,d,e,b[f+3],10,-1894986606),e=l(e,c,a,d,b[f+10],15,-1051523),d=l(d,e,c,a,b[f+1],21,-2054922799),a=l(a,d,e,c,b[f+8],6,1873313359),c=l(c,a,d,e,b[f+15],10,-30611744),e=l(e,c,a,d,b[f+6],15,-1560198380),d=l(d,e,c,a,b[f+13],21,1309151649),a=l(a,d,e,c,b[f+4],6,-145523070),c=l(c,a,d,e,b[f+11],10,-1120210379),e=l(e,c,a,d,b[f+2],15,718787259),d=l(d,e,c,a,b[f+9],21,-343485551),a=a+m>>>0,d=d+n>>>0,e=e+p>>>0,c=c+q>>>0;return o.endian([a,d,e,c])};i._ff=function(a,b,g,d,e,c,f){a=a+(b&g|~b&d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._gg=function(a,b,g,d,e,c,f){a=a+(b&d|g&~d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._hh=function(a,b,g,d,e,c,f){a=a+(b^g^d)+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._ii=function(a,b,g,d,e,c,f){a=a+(g^(b|~d))+(e>>>0)+f;return(a<<c|a>>>32-c)+b};i._blocksize=16;i._digestsize=16})();

JCSDL.Loader.addComponent(function($){(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=this.element[0],i=!1;while(r&&(r=r.parentNode))r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(jQuery);(function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r)return i=e(this),!1});e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target));if(!i)return!1;if(this.options.handle&&!n){var o=!1;e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0)});if(!o)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(s.instance!==this.currentContainer)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var s=r.length-1;s>=0;s--)r[s][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i&&this.ready)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a))}}for(var s=r.length-1;s>=0;s--){var f=r[s][1],l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());var s=i.offset();r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(n.style.visibility="hidden"),n},update:function(e,i){if(r&&!n.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!n)return;if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else{var s=1e4,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];for(var l=this.items.length-1;l>=0;l--){if(!e.contains(this.containers[r].element[0],this.items[l].item[0]))continue;if(this.items[l].item[0]==this.currentItem[0])continue;var c=this.items[l].item.offset()[u],h=!1;Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down")}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=!1;var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;for(t=s.length;t<r;t++)u.push(o);this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})})(jQuery);});

JCSDL.Loader.addComponent(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}
var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}
event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}
mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}
touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}
this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}
simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}
touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};});

JCSDL.Loader.addComponent(function($){function fixTitle($ele){if($ele.attr('title')||typeof($ele.attr('original-title'))!='string'){$ele.attr('original-title',$ele.attr('title')||'').removeAttr('title');}}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;fixTitle(this.$element);}
Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;var gravity=(typeof this.options.gravity=='function')?this.options.gravity.call(this.$element[0]):this.options.gravity;var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){return this.data('tipsy')[options]();}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.8,title:'title',trigger:'hover'};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};});

JCSDL.Loader.addComponent(function($){$.fn.extend({simulate:function(type,options){return this.each(function(){var opt=$.extend({},$.simulate.defaults,options||{});new $.simulate(this,type,opt);});}});$.simulate=function(el,type,options){this.target=el;this.options=options;if(/^drag$/.test(type)){this[type].apply(this,[this.target,options]);}else{this.simulateEvent(el,type,options);}}
$.extend($.simulate.prototype,{simulateEvent:function(el,type,options){var evt=this.createEvent(type,options);this.dispatchEvent(el,type,evt,options);return evt;},createEvent:function(type,options){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(type)){return this.mouseEvent(type,options);}else if(/^key(up|down|press)$/.test(type)){return this.keyboardEvent(type,options);}},mouseEvent:function(type,options){var evt;var e=$.extend({bubbles:true,cancelable:(type!="mousemove"),view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},options);var relatedTarget=$(e.relatedTarget)[0];if($.isFunction(document.createEvent)){evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget||document.body.parentNode);}else if(document.createEventObject){evt=document.createEventObject();$.extend(evt,e);evt.button={0:1,1:4,2:2}[evt.button]||evt.button;}
return evt;},keyboardEvent:function(type,options){var evt;var e=$.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},options);if($.isFunction(document.createEvent)){try{evt=document.createEvent("KeyEvents");evt.initKeyEvent(type,e.bubbles,e.cancelable,e.view,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);}catch(err){evt=document.createEvent("Events");evt.initEvent(type,e.bubbles,e.cancelable);$.extend(evt,{view:e.view,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,keyCode:e.keyCode,charCode:e.charCode});}}else if(document.createEventObject){evt=document.createEventObject();$.extend(evt,e);}
if($.browser.msie||$.browser.opera){evt.keyCode=(e.charCode>0)?e.charCode:e.keyCode;evt.charCode=undefined;}
return evt;},dispatchEvent:function(el,type,evt){if(el.dispatchEvent){el.dispatchEvent(evt);}else if(el.fireEvent){el.fireEvent('on'+type,evt);}
return evt;},drag:function(el){var self=this,center=this.findCenter(this.target),options=this.options,x=Math.floor(center.x),y=Math.floor(center.y),dx=options.dx||0,dy=options.dy||0,target=this.target;var coord={clientX:x,clientY:y};this.simulateEvent(target,"mousedown",coord);coord={clientX:x+1,clientY:y+1};this.simulateEvent(document,"mousemove",coord);coord={clientX:x+dx,clientY:y+dy};this.simulateEvent(document,"mousemove",coord);this.simulateEvent(document,"mousemove",coord);this.simulateEvent(target,"mouseup",coord);},findCenter:function(el){var el=$(this.target),o=el.offset();return{x:o.left+el.outerWidth()/2,y:o.top+el.outerHeight()/2};}});$.extend($.simulate,{defaults:{speed:'sync'},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40});});
;JCSDL.Loader.addComponent(function($,undefined){this.Parser=function(gui){this.gui=gui;};this.Parser.prototype={v:'2.0',parseJCSDL:function(code){var lines=code.split("\n"),masterLine=lines.shift(),endLine=lines.pop();if(!this.verifyJCSDL(masterLine,lines)){throw new JCSDL.ValidationException("The given JCSDL did not verify!",code);}
var versionLine=lines.shift(),logic=masterLine.split(' ')[3],filters=[];if(lines[0].substr(0,2)!=='//'){lines.shift();}
while(lines.length>1){var jcsdlDescription=lines.shift(),csdl=lines.shift(),jcsdlEnd=lines.shift();lines.shift();jcsdlDescription=jcsdlDescription.split(' ');var jcsdlHash=jcsdlDescription[2],jcsdlCode=jcsdlDescription[3],filterId=jcsdlDescription[4]||filters.length+1;if(!this.verifyJCSDLFilter(jcsdlHash,csdl)){throw new JCSDL.ValidationException("The given JCSDL Filter code did not verify!",csdl);}
var filter=this.filterFromJCSDL(jcsdlCode,csdl,filterId);filters.push(filter);}
return{filters:filters,logic:logic};},filterFromJCSDL:function(jcsdlCode,csdl,filterId){jcsdlCode=jcsdlCode.split(',');var fieldPath=jcsdlCode.shift().split('.'),target=fieldPath.shift(),fieldInfo=this.getFieldInfo(target,fieldPath);if(fieldInfo===false)return false;var operator=jcsdlCode.shift(),value='',additional={cs:false};if(operator!=='exists'){var range=jcsdlCode.shift().split('-');value=this.valueFromCSDL(fieldInfo,csdl.substr(range[0],range[1]),operator);$.each(jcsdlCode,function(i,code){switch(code){case'cs':additional.cs=true;break;}});}
return this.createFilter(target,fieldPath,operator,value,additional,filterId);},getJCSDLForFilters:function(filters,logic){var self=this,filterCodes={},filterLines=[],filtersCsdl='';$.each(filters,function(i,filter){var parsedFilter=self.filterToCSDL(filter);if(!parsedFilter)return true;filterCodes[filter.id+'']=parsedFilter;});if(logic!='AND'&&logic!='OR'){var tokens=this.tokenizeLogicString(logic),logicLine='';this.validateLogic(tokens,filters);$.each(tokens,function(i,token){if(typeof token==='number'){if(logicLine.length){filterLines.push($.trim(logicLine));}
logicLine='';if(filterCodes[token+'']!==undefined){filterLines.push(filterCodes[token+'']);}else{throw new JCSDL.LogicValidationException("A filter with ID '"+token+"' doesn't exist! You cannot use it in a logical expression",i);}}else if(token=='&'||token=='|'){logicLine+=(token=='|')?' OR ':' AND ';}else{logicLine+=token;}});if(logicLine.length){filterLines.push($.trim(logicLine));}
filtersCsdl=filterLines.join("\n");}else{$.each(filterCodes,function(i,csdl){filterLines.push(csdl);});filtersCsdl=filterLines.join("\n"+logic+"\n");}
var output='// JCSDL_VERSION '+this.v+"\n"+filtersCsdl,hash=this.encodeJCSDL(output,logic);output='// JCSDL_MASTER '+hash+' '+logic+"\n"+output+"\n// JCSDL_MASTER_END";return output;},filterToCSDL:function(filter){var fieldInfo=this.getFieldInfo(filter.target,filter.fieldPath);if(fieldInfo===false)return false;var value=this.valueToCSDL(filter.value,fieldInfo,filter.operator);if(value===false)return false;var field=this.fieldToCSDL(filter.fieldPath);if(field===false)return false;var operatorCode=this.getOperatorCode(filter.operator);if(operatorCode===false)return false;var cs=(filter.cs)?' cs':'';var csdl=((filter.target=='augmentation')?'':filter.target+'.')+field.replace('-','.')+cs+' '+operatorCode+' ',jcsdlSyntax=filter.target+'.'+field+','+filter.operator;if(filter.operator!=='exists'){var valueStart=(fieldInfo.type=='string'||fieldInfo.type=='geo')?csdl.length+1:csdl.length,valueLength=(fieldInfo.type=='string'||fieldInfo.type=='geo')?value.length-2:value.length;csdl=csdl+value;jcsdlSyntax+=','+valueStart+'-'+valueLength;if(filter.cs){jcsdlSyntax+=',cs';}}
var hash=this.encodeJCSDLFilter(csdl),jcsdl_start=['// JCSDL_START',hash,jcsdlSyntax,filter.id].join(' '),jcsdl_end='// JCSDL_END';return[jcsdl_start,csdl,jcsdl_end].join("\n");},encodeJCSDL:function(output,logic){return Crypto.MD5(logic+"\n"+output);},verifyJCSDL:function(masterLine,lines){var input=lines.join("\n"),masterInfo=masterLine.split(' '),logic=masterInfo[3],hash=masterInfo[2],jcsdlHash=this.encodeJCSDL(input,logic);return(hash==jcsdlHash);},encodeJCSDLFilter:function(csdl){return Crypto.MD5(csdl);},verifyJCSDLFilter:function(hash,csdl){return(hash==this.encodeJCSDLFilter(csdl));},fieldToCSDL:function(fieldPath){return fieldPath.join('.');},valueToCSDL:function(value,fieldInfo,operator){var parsedValue='';if(fieldInfo.type=='int'||fieldInfo.type=='float'){if(operator!=='in'&&isNaN(value)){this.error('This field value is suppose to be a Number, String given.',value,fieldInfo);return false;}else if(operator=='in'){value=value.split(',');$.each(value,function(i,val){value[i]==parseInt(val);});parsedValue='['+value.join(',')+']';}else{parsedValue=value;}}else{var escapeRegEx=($.inArray(operator,['regex_partial','regex_exact'])>=0)?true:false;parsedValue='"'+value.escapeCsdl(escapeRegEx)+'"';}
return parsedValue;},valueFromCSDL:function(fieldInfo,value,operator){if(fieldInfo.type=='int'){if(operator=='in'){value=value.substr(1,value.length-2);}
return value;}else{var escapeRegEx=($.inArray(operator,['regex_partial','regex_exact'])>=0)?true:false;return value.unescapeCsdl(escapeRegEx);}},tokenizeLogicString:function(logicString){logicString=''+logicString;logicString=logicString.replace(/\s+/g,'');var tokens=[],wasNumber=false;for(var i=0;i<logicString.length;i++){var ch=logicString.charAt(i);if(ch.isNumeric()){if(wasNumber){tokens[tokens.length-1]+=''+ch;tokens[tokens.length-1]=parseInt(tokens[tokens.length-1]);}else{tokens.push(parseInt(ch));}
wasNumber=true;}else{tokens.push(ch);wasNumber=false;}}
return tokens;},validateLogic:function(logic,availableFilters){var tokens=(typeof logic==='string'||typeof logic==='number')?this.tokenizeLogicString(logic):logic;if($.inArray(tokens[0],['&','|'])>=0){throw new JCSDL.LogicValidationException('Logical query cannot start with logical operator "'+tokens[0]+'"!',0);}
if($.inArray(tokens[tokens.length-1],['&','|'])>=0){throw new JCSDL.LogicValidationException('Logical query cannot end with logical operator "'+tokens[tokens.length-1]+'"!',tokens.length-1);}
var prev=null,filters=[],level=0,filterIds=[];if(availableFilters&&availableFilters.length){$.each(availableFilters,function(i,filter){filterIds.push(parseInt(filter.id));});}
$.each(tokens,function(i,token){if(token=='('&&prev==')')throw new JCSDL.LogicValidationException('You cannot use opening parenthesis "(" right after a closing parenthesis ")"!',i);if(token==')'&&prev=='(')throw new JCSDL.LogicValidationException('You cannot use closing parenthesis ")" right after an opening parenthesis "("!',i);if(token==')'&&$.inArray(prev,['&','|'])>=0)throw new JCSDL.LogicValidationException('You cannot use closing parenthesis ")" right after a logical operator!',i);if($.inArray(token,['&','|'])>=0&&prev=='(')throw new JCSDL.LogicValidationException('You cannot use logical operator "'+token+'" right after opening brackets!',i);if(token=='('&&typeof prev=='number')throw new JCSDL.LogicValidationException('You cannot open a parenthesis right after filter ID! You need to use a logical operator "&" or "|"!',i);if(typeof token=='number'&&prev==')')throw new JCSDL.LogicValidationException('You cannot use filter ID right after closing a parenthesis! You need to use a logical operator "&" or "|"!',i);if($.inArray(token,['&','|'])>=0&&$.inArray(prev,['&','|'])>=0)throw new JCSDL.LogicValidationException('You cannot use two logical operators next to each other!',i);if(typeof token=='number'){if(typeof prev=='number'){throw new JCSDL.LogicValidationException('Cannot use two filter ID\'s next to each other!',i);}
if($.inArray(token,filterIds)==-1)throw new JCSDL.LogicValidationException('The filter ID "'+token+'" doesn\'t exist! You can only use filters from the list of filters.',i);if($.inArray(token,filters)>=0)throw new JCSDL.LogicValidationException('The filter with ID "'+token+'" has already been used in the logical expression! You can only use one filter once.',i);filters.push(token);}
if($.inArray(token,['(',')'])>=0){level=(token=='(')?level+1:level-1;if(level<0){throw new JCSDL.LogicValidationException('Parentheses do not create a logical expression, i.e. there are too many closing parenthesis that close a nested expression that was never opened!',i);}}
prev=token;});if(level!==0){throw new JCSDL.LogicValidationException('You have\'t closed some parentheses!');}
return true;},error:function(message,code){this.gui.showError.apply(this.gui,arguments);},createFilter:function(target,fieldPath,operator,value,additional,filterId){additional=additional||{};var filter={id:filterId,target:target,fieldPath:fieldPath,operator:operator,value:value,cs:additional.cs}
return filter;},getOperatorCode:function(operatorName){return this.gui.definition.operators[operatorName].code;},getTargetInfo:function(target){if(this.gui.definition.targets[target]!==undefined){return this.gui.definition.targets[target];}
this.error('Such target does not exist!',target);return false;},getFieldInfo:function(target,fieldPath){var self=this;var field=this.gui.definition.targets[target];if(field===undefined){this.error('Such target does not exist!',target);return false;}
$.each(fieldPath,function(i,fieldName){if(field.fields!==undefined){if(field.fields[fieldName]!==undefined){field=field.fields[fieldName];}else{self.error('Invalid path to a field (#1)!',target,fieldPath,field);field=false;return false;}}else{self.error('Invalid path to a field (#2)!',target,fieldPath,field);field=false;return false;}});return field;}};this.ValidationException=function(message,code){this.message=message;this.code=code;};this.LogicValidationException=function(message,index){this.message=message;this.index=index;};});
;JCSDL.Loader.addComponent(function($,undefined){this.GUITemplates={container:$('<div class="jcsdl-container" />'),editor:$(['<div class="jcsdl-mainview">','<div class="jcsdl-header">','<div class="jcsdl-row">','<h3>Filters</h3>','<div class="jcsdl-actions">','<a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-save">Save and Preview</a>','<a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-cancel">Cancel</a>','</div>','</div>','<div class="jcsdl-advanced-container jcsdl-bordered" style="display: none;">','<div class="jcsdl-advanced-gui-container">','<ul class="jcsdl-advanced-gui" />','<a href="#" class="jcsdl-advanced-gui-arrow left off"><span class="jcsdl-elements-sprite" /></a>','<a href="#" class="jcsdl-advanced-gui-arrow right off"><span class="jcsdl-elements-sprite" /></a>','</div>','<div class="jcsdl-advanced-manual" style="display: none;">','<input type="text" name="advanced" placeholder="1&(2|3)..." />','</div>','</div>','<div class="jcsdl-row">','<div class="jcsdl-filters-logic">','<a href="#" class="jcsdl-bordered jcsdl-filters-logic-option jcsdl-and active disabled" data-logic="AND" data-text-long="ALL of the following" data-text-short="ALL">ALL of the following</a>','<a href="#" class="jcsdl-bordered jcsdl-filters-logic-option jcsdl-or disabled" data-logic="OR" data-text-long="ANY of the following" data-text-short="ANY">ANY of the following</a>','<a href="#" class="jcsdl-bordered jcsdl-filters-logic-option jcsdl-advanced disabled" data-logic="ADVANCED">','ADVANCED','<span class="jcsdl-logic-help" data-text-general="Use the advanced option to create logical expressions." data-text-gui="Drag and drop the tiles to create an advanced query." data-text-manual="Type a logical expression to create an advanced query.">?</span>','</a>','<a href="#" class="jcsdl-bordered jcsdl-filters-logic-option jcsdl-advanced-option jcsdl-advanced-add-brackets active">+ [ ]</a>','<a href="#" class="jcsdl-bordered jcsdl-filters-logic-option jcsdl-advanced-option jcsdl-advanced-manual-edit active" data-text-gui="Manual Edit" data-text-manual="Graphical Edit">Manual Edit</a>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto jcsdl-elements-sprite"></div>','Create New Filter','</a>','</div>','<div class="jcsdl-mainview-mode">','<div class="jcsdl-label">View as:</div>','<div class="jcsdl-bordered jcsdl-mainview-mode-options">','<a href="#" class="jcsdl-mainview-mode-option jcsdl-elements-sprite jcsdl-expanded active" data-mode="expanded"></a>','<a href="#" class="jcsdl-mainview-mode-option jcsdl-elements-sprite jcsdl-collapsed" data-mode="collapsed"></a>','</div>','</div>','</div>','</div>','<div class="jcsdl-filters-list expanded">','</div>','<div class="jcsdl-footer">','<div class="jcsdl-actions">','<a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-save">Save and Preview</a>','<a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-editor-cancel">Cancel</a>','</div>','<div class="jcsdl-mainview-actions">','<a href="#" class="jcsdl-bordered jcsdl-mainview-action jcsdl-add-filter">','<div class="jcsdl-picto jcsdl-elements-sprite"></div>','Create New Filter','</a>','</div>','</div>','</div>'].join('')),filter:$(['<div class="jcsdl-filter">','<div class="jcsdl-filter-description">','<div class="jcsdl-filter-info jcsdl-bordered id" />','<div class="jcsdl-filter-info target" />','<div class="jcsdl-filter-info field" />','<div class="jcsdl-filter-info operator" />','<div class="jcsdl-filter-info jcsdl-bordered value" />','</div>','<div class="jcsdl-filter-options">','<a href="#" class="edit">Edit</a>','<span>/</span>','<a href="#" class="delete">Delete</a>','</div>','</div>'].join('')),filterTarget:$('<div class="jcsdl-filter-target jcsdl-icon target" />'),filterField:$('<div class="jcsdl-filter-field jcsdl-icon field" />'),filterFieldInput:$(['<div class="jcsdl-filter-info input">','<div class="jcsdl-filter-field-input jcsdl-icon input" />','</div>'].join('')),filterOperator:$('<div class="jcsdl-filter-operator jcsdl-icon operator" />'),filterValue:$('<div class="jcsdl-filter-value" />'),error:$(['<div class="jcsdl-error jcsdl-elements-sprite">','<strong>Error:</strong>','<span />','</div>'].join('')),logicToken_operatorAnd:$('<div href="#" class="jcsdl-logic-token operator" data-token="&">AND</div>'),logicToken_operatorOr:$('<div href="#" class="jcsdl-logic-token operator" data-token="|">OR</div>'),logicToken_bracketOpen:$('<div href="#" class="jcsdl-logic-token bracket" data-token="(">[<a href="#" class="jcsdl-delete-token"><span class="jcsdl-elements-sprite"/ ></a></div>'),logicToken_bracketClose:$('<div href="#" class="jcsdl-logic-token bracket" data-token=")">]<a href="#" class="jcsdl-delete-token"><span class="jcsdl-elements-sprite" /></a></div>'),logicToken_filter:$('<div href="#" class="jcsdl-logic-token filter" data-token="#">#</div>'),filterEditor:$(['<div class="jcsdl-filter-editor">','<div class="jcsdl-steps">','</div>','<div class="jcsdl-footer">','<a href="#" class="jcsdl-button jcsdl-elements-sprite jcsdl-filter-save">Save and Preview</a>','<span style="display: none;">or</span> <a href="#" class="jcsdl-filter-cancel">cancel</a>','</div>','</div>'].join('')),step:$('<div class="jcsdl-step" />'),target:$(['<div class="jcsdl-filter-target-wrap">','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a>','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target jcsdl-carousel" />','</div>','</div>'].join('')),targetOption:$('<a href="#" class="jcsdl-icon target jcsdl-carousel-item"></a>'),field:$(['<div class="jcsdl-filter-target-field-wrap">','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a>','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target-field jcsdl-carousel" />','</div>','</div>'].join('')),fieldOption:$('<a href="#" class="jcsdl-icon field jcsdl-carousel-item" />'),inputSelect:$(['<div class="jcsdl-filter-target-field-input-wrap">','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite left"></a>','<a href="#" class="jcsdl-carousel-scroll jcsdl-elements-sprite right"></a>','<div class="jcsdl-carousel-wrap">','<div class="jcsdl-filter-target-field-input jcsdl-carousel" />','</div>','</div>'].join('')),inputSelectOption:$('<a href="#" class="jcsdl-icon input jcsdl-carousel-item" />'),targetHelp:$('<a href="#" class="jcsdl-target-help">Learn More</a>'),valueInput:$(['<div class="jcsdl-filter-value-input">','<div class="jcsdl-filter-value-input-operators" />','<div class="jcsdl-filter-value-input-field" />','</div>'].join('')),operatorOption:$('<a href="#" class="jcsdl-icon operator" />'),textOperatorsSelect:$(['<div class="jcsdl-operators-select">','<div class="jcsdl-operator-label" />','<div class="jcsdl-dropdown-icon jcsdl-elements-sprite" />','</div>'].join('')),textOperatorsDropdown:$('<div class="jcsdl-dropdown jcsdl-operators-dropdown" />'),textOperatorOption:$(['<div class="jcsdl-dropdown-option">','<div class="jcsdl-icon operator" />','<a href="#" class="jcsdl-dropdown-details-trigger jcsdl-elements-sprite">?</a>','<div class="jcsdl-dropdown-option-desc">','<div class="jcsdl-operator-label">','<span /> ','<a href="#" class="jcsdl-operator-help">(?)</a>','</div>','<div class="jcsdl-operator-desc" />','</div>','</div>'].join('')),caseSensitivity:$('<a class="jcsdl-operator-cs jcsdl-icon icon-cs operator" title="Case Sensitive" />'),valueInput_text:$(['<div class="jcsdl-input-text">','<input type="text" placeholder="Type your desired value..." class="orig" />','<div class="jcsdl-containsnear-distance">','<span>Distance:</span>','<input type="text" placeholder="e.g. 0" value="2" class="dist" />','</div>','</div>'].join('')),valueInput_number:$(['<div class="jcsdl-input-number">','<input type="text" placeholder="e.g. 3.14" />','</div>'].join('')),valueInput_select:$('<div class="jcsdl-input-select" />'),valueInput_select_option:$(['<a href="#" class="jcsdl-input-select-option">','<span />','</a>'].join('')),valueInput_select_more:$('<span class="jcsdl-input-select-more">and <span class="count"></span> more...</span>'),valueInput_slider:$(['<div class="jcsdl-input-slider">','<div class="jcsdl-slider-controls">','<a href="#" class="jcsdl-slider-minus jcsdl-elements-sprite" />','<a href="#" class="jcsdl-slider-plus jcsdl-elements-sprite" />','<input type="text" name="value" class="jcsdl-slider-input" placeholder="0" />','</div>','<div class="jcsdl-slider-wrap">','<div class="jcsdl-slider-icon min" />','<div class="jcsdl-slider-icon max" />','<div class="jcsdl-slider-container">','<div class="jcsdl-slider-label min" />','<div class="jcsdl-slider-label max" />','<div class="jcsdl-slider jcsdl-elements-sprite" />','<div class="jcsdl-slider-bottom">','<div class="jcsdl-slider-bottom-left jcsdl-elements-sprite" />','<div class="jcsdl-slider-bottom-right jcsdl-elements-sprite" />','<div class="jcsdl-slider-bottom-line jcsdl-elements-sprite" />','</div>','</div>','</div>','</div>'].join('')),valueInput_geo_map:$(['<div class="jcsdl-map">','<input type="text" name="location" class="jcsdl-map-search" placeholder="Search for location..." />','<div class="jcsdl-map-canvas" />','<a href="#" class="jcsdl-clear-map">clear coordinates</a>','<p class="jcsdl-map-instructions" />','<div class="jcsdl-map-coordinates" />','<div class="jcsdl-map-area">','<label>Area:</label>','<span>0 km<sup>2</sup></span>','</div>','</div>'].join('')),valueInput_geobox:$(['<div class="jcsdl-input-geo jcsdl-geo-box" />'].join('')),valueInput_geobox_coordinates:$(['<ul>','<li class="nw"><label>NW:</label><span /></li>','<li class="ne"><label>NE:</label><span /></li>','<li class="se"><label>SE:</label><span /></li>','<li class="sw"><label>SW:</label><span /></li>','</ul>'].join('')),valueInput_georadius:$(['<div class="jcsdl-input-geo jcsdl-geo-radius" />'].join('')),valueInput_georadius_coordinates:$(['<ul>','<li class="center"><label>Center:</label><span /></li>','<li class="radius"><label>Radius:</label><span /></li>','</ul>'].join('')),valueInput_geopolygon:$(['<div class="jcsdl-input-geo jcsdl-geo-polygon" />'].join('')),valueInput_geopolygon_coordinates:$(['<ul />'].join(''))};});
;JCSDL.Loader.addComponent(function($,undefined){this.GUIInputs=function(gui){this.gui=gui;this.definition=gui.definition;this.getTemplate=gui.getTemplate;};this.GUIInputs.prototype={exec:function(t,m,a){return this[t][m].apply(this,a);},text:{init:function(info){var $view=this.getTemplate('valueInput_text'),$input=$view.find('input.orig');$input.jcsdlTagInput();$input.jcsdlRegExTester();$view.find('input.dist').jcsdlNumberMask();return $view;},setValue:function($view,info,val,operator){if(operator=='contains_near'){val=val.split(':');var dist=parseInt(val.pop());$view.find('input.dist').val(dist);val=val.join(':').replace(/\\:/g,':');}
$view.find('input.orig').val(val);},getValue:function($view,info,operator){var val=$view.find('input.orig').val();if(operator=='contains_near'){val=val.replace(/:/g,'\\:')+':'+parseInt($view.find('input.dist').val());}
return val;},displayValue:function(info,val,filter){if(filter.operator=='contains_near'){val=val.split(':');var dist=parseInt(val.pop());val=val.join(':').truncate(50,'...',true).escapeHtml();return val+' : '+dist;}
return val.truncate(50,'...',true).escapeHtml();}},number:{init:function(info){var $view=this.getTemplate('valueInput_number'),fl=(info.type=='float'),arr=($.inArray('in',info.operators)>=0),$input=$view.find('input[type=text]');$input.jcsdlNumberMask(fl);if(arr){$input.jcsdlTagInput({numbers:true,floats:fl});}
return $view;},setValue:function($view,info,val,operator){$view.find('input[type=text]:first').val(val);},getValue:function($view,info,operator){return $view.find('input[type=text]:first').val();},displayValue:function(info,val,filter){if(filter.operator!=='in')return val;var fl=(info.type=='float');val=val.split(',');var show=val.slice(0,3);$.each(show,function(i,v){show[i]=(fl)?parseFloat(v).format(2):v;});var more=(show.length<val.length)?' and '+(val.length-show.length)+' more...':'';return show.join(', ')+more;}},select:{init:function(info){var self=this,$view=this.getTemplate('valueInput_select'),opts=this.exec('select','getOptionsSet',[info]);$.each(opts,function(val,lbl){self.exec('select','createOptionView',[val,lbl]).appendTo($view);});$view.find('.jcsdl-input-select-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();if(info.single){$view.find('.jcsdl-input-select-option').removeClass('selected');}
$(this).toggleClass('selected');});return $view;},setValue:function($view,info,val,operator){var vals=val.split(',');$.each(vals,function(i,v){$view.find('.jcsdl-input-select-option.option-'+v).addClass('selected');});},getValue:function($view,info,operator){var vals=[];$view.find('.jcsdl-input-select-option.selected').each(function(i,o){vals.push($(o).data('value'));});return vals.join(',');},displayValue:function(info,val,filter){var self=this,vals=val.split(','),$view=this.getTemplate('valueInput_select');if(vals.length==0)return $view;var opts=this.exec('select','getOptionsSet',[info]);var show=vals.slice(0,5);$.each(show,function(i,v){if(opts[v]===undefined)return true;self.exec('select','createOptionView',[v,opts[v]]).addClass('selected').appendTo($view);});if(vals.length>show.length){var $ind=this.getTemplate('valueInput_select_more');$ind.find('.count').html(vals.length-show.length);$ind.appendTo($view);}
$view.find('.jcsdl-input-select-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();});return $view;},getOptionsSet:function(info){var opts={};if(info.options!==undefined){opts=info.options;}else if((info.optionsSet!==undefined)&&(this.definition.inputs.select.sets[info.optionsSet]!==undefined)){opts=this.definition.inputs.select.sets[info.optionsSet];}
return opts;},createOptionView:function(val,lbl){var $v=this.getTemplate('valueInput_select_option').data('value',val).addClass('option-'+val).attr('title',lbl);$v.find('span').html(lbl);return $v;}},slider:{init:function(info){var self=this,$view=this.getTemplate('valueInput_slider'),opts=this.exec('slider','getOptions',[info]),$slider=$view.find('.jcsdl-slider').slider({animate:true,min:opts.min,max:opts.max,step:opts.step,value:opts['default'],slide:function(ev,ui){$view.find('.jcsdl-slider-input').val(self.exec('slider','parseValue',[info,ui.value]));}});this.exec('slider','setValue',[$view,info,opts['default']]);$view.find('.jcsdl-slider-label.min').html(this.exec('slider','displayValue',[info,opts.min]));$view.find('.jcsdl-slider-label.max').html(this.exec('slider','displayValue',[info,opts.max]));$view.find('.jcsdl-slider-input').jcsdlNumberMask((info.type=='float')).keyup(function(ev){if(ev.which==110||ev.which==190)return;var v=$(this).val();self.exec('slider','setValue',[$view,info,parseFloat((v)?v:0)]);});var changeValue=function($view,info,step,minus){var val=parseFloat($view.find('.jcsdl-slider-input').val());val=(minus)?val-step:val+step;self.exec('slider','setValue',[$view,info,val]);}
var interval=null;$view.find('.jcsdl-slider-minus, .jcsdl-slider-plus').bind('mousedown touchstart',function(ev){var min=$(this).is('.jcsdl-slider-minus');interval=setInterval(function(){changeValue($view,info,opts.step,min);},50);}).bind('mouseup mouseout touchend',function(ev){clearInterval(interval);}).click(function(ev){ev.preventDefault();ev.target.blur();});return $view;},setValue:function($view,info,val,operator){var opts=this.exec('slider','getOptions',[info]);val=(val>opts.max)?opts.max:((val<opts.min)?opts.min:val);$view.find('.jcsdl-slider').slider('value',val);$view.find('.jcsdl-slider-input').val(val);},getValue:function($view,info,operator){return this.exec('slider','parseValue',[info,$view.find('.jcsdl-slider-input').val()]);},displayValue:function(info,val,filter){var opts=this.exec('slider','getOptions',[info]);return opts.displayFormat.apply(opts,[val.toString()]);},parseValue:function(info,val){return val;},getOptions:function(info){return $.extend({},this.definition.inputs.slider,{min:info.min,max:info.max,step:info.step,'default':info['default'],displayFormat:info.displayFormat});}},_geo:{mapOptions:{},initSearch:function($view){var map=$view.data('map'),$ac=$view.find('.jcsdl-map-search'),ac=new google.maps.places.Autocomplete($ac[0],{});google.maps.event.addListener(ac,'place_changed',function(){var place=ac.getPlace();if(place.geometry===undefined){if($('.pac-container .pac-item').length>0){$ac.trigger('focus');$ac.simulate('keydown',{keyCode:40});$ac.simulate('keydown',{keyCode:13});}
return;}
if(place.geometry.viewport){map.fitBounds(place.geometry.viewport);}else{map.setCenter(place.geometry.location);map.setZoom(17);}});},isNorth:function(c1,c2){return(c1.lat()>=c2.lat());},isEast:function(c1,c2){return(c1.lng()>=c2.lng());}},geo_box:{init:function(info){var $view=this.getTemplate('valueInput_geobox');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_geobox_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_box.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_box','load',[info,$view]]);return $view;},load:function(info,$view){var self=this,map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var rect=new google.maps.Rectangle($.extend({},this.gui.config.mapsOverlay,{}));$view.data('rect',rect);var coords=[];var mOpt={position:new google.maps.LatLng(0,0),draggable:true,icon:this.gui.config.mapsMarker};var markers=[new google.maps.Marker(mOpt),new google.maps.Marker(mOpt)];$view.data('markers',markers);this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){if(coords.length>=2)coords.pop();coords.push(ev.latLng);var m=coords.length-1;markers[m].setPosition(ev.latLng);if(!$view.data('bothMarkersVisible'))markers[m].setAnimation(google.maps.Animation.DROP);markers[m].setMap(map);if(coords.length==2){self.exec('geo_box','drawRectangle',[map,rect,coords]);$view.data('bothMarkersVisible',true);}
$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[coords.length]);$view.find('.jcsdl-clear-map').fadeIn();});google.maps.event.addListener(markers[0],'position_changed',function(){coords[0]=this.getPosition();self.exec('geo_box','drawRectangle',[map,rect,coords]);if(coords.length==2){self.exec('geo_box','updateInfo',[$view,rect]);}});google.maps.event.addListener(markers[1],'position_changed',function(){coords[1]=this.getPosition();self.exec('geo_box','drawRectangle',[map,rect,coords]);self.exec('geo_box','updateInfo',[$view,rect]);});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();coords=[];rect.setMap(null);markers[0].setMap(null);markers[1].setMap(null);$view.data('bothMarkersVisible',false);$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this,$geoView=$view.find('.jcsdl-input-geo');val=val.split(':');var nw=val[0].split(',');var se=val[1].split(',');setTimeout(function(){var map=$geoView.data('map'),rect=$geoView.data('rect'),tips=self.exec('geo_box','getAllTipsFromNWSE',[nw,se]),bounds=new google.maps.LatLngBounds(tips.sw,tips.ne);self.exec('geo_box','drawRectangleFromBounds',[map,rect,bounds]);var markers=$geoView.data('markers');markers[0].setMap(map);markers[0].setPosition(tips.ne);markers[1].setMap(map);markers[1].setPosition(tips.sw);map.fitBounds(rect.getBounds());self.exec('geo_box','updateInfo',[$geoView,rect]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_box.instructions[2]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var rect=$view.find('.jcsdl-input-geo').data('rect');if(!rect.getMap())return'';var tips=this.exec('geo_box','getAllTipsFromBounds',[rect.getBounds()]);return tips.nw.lat()+','+tips.nw.lng()+':'+tips.se.lat()+','+tips.se.lng();},displayValue:function(info,val,filter){val=val.split(':');var v1=val[0].split(',');var v2=val[1].split(',');return parseFloat(v1[0]).format(2)+', '+parseFloat(v1[1]).format(2)+' : '+parseFloat(v2[0]).format(2)+', '+parseFloat(v2[1]).format(2);},drawRectangle:function(map,rect,coords){if(coords.length!=2)return false;var tips=this.exec('geo_box','getAllTipsFromUnspecified',[coords[0],coords[1]]),bounds=new google.maps.LatLngBounds(tips.sw,tips.ne);this.exec('geo_box','drawRectangleFromBounds',[map,rect,bounds]);return true;},drawRectangleFromBounds:function(map,rect,bounds){rect.setBounds(bounds);rect.setMap(map);},getAllTipsFromBounds:function(bounds){var tips={};tips.ne=bounds.getNorthEast();tips.sw=bounds.getSouthWest();tips.nw=new google.maps.LatLng(tips.ne.lat(),tips.sw.lng());tips.se=new google.maps.LatLng(tips.sw.lat(),tips.ne.lng());return tips;},getAllTipsFromNWSE:function(nw,se){var tips={};tips.nw=new google.maps.LatLng(parseFloat(nw[0]),parseFloat(nw[1]));tips.se=new google.maps.LatLng(parseFloat(se[0]),parseFloat(se[1]));tips.ne=new google.maps.LatLng(tips.nw.lat(),tips.se.lng());tips.sw=new google.maps.LatLng(tips.se.lat(),tips.nw.lng());return tips;},getAllTipsFromUnspecified:function(c1,c2){var tips={},n,s,w,e;if(this._geo.isNorth(c1,c2)){n=c1;s=c2;}else{n=c2;s=c1;}
if(this._geo.isEast(c1,c2)){e=c1;w=c2;}else{e=c2;w=c1;}
var tips={nw:new google.maps.LatLng(n.lat(),w.lng()),ne:new google.maps.LatLng(n.lat(),e.lng()),se:new google.maps.LatLng(s.lat(),e.lng()),sw:new google.maps.LatLng(s.lat(),w.lng())};return tips;},updateInfo:function($view,rect){var tips=this.exec('geo_box','getAllTipsFromBounds',[rect.getBounds()]),area=google.maps.geometry.spherical.computeArea([tips.nw,tips.ne,tips.se,tips.sw]);$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');$.each(tips,function(point,coords){$view.find('.jcsdl-map-coordinates .'+point+' span').html(coords.lat().format(2)+', '+coords.lng().format(2));});}},geo_radius:{init:function(info){var $view=this.getTemplate('valueInput_georadius');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_georadius_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_radius.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_radius','load',[info,$view]]);return $view;},load:function(info,$view){var self=this;var map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var opt=$.extend({},this.gui.config.mapsOverlay,{});var circle=new google.maps.Circle(opt);$view.data('circle',circle);var markerOptions={position:new google.maps.LatLng(0,0),draggable:true,icon:this.gui.config.mapsMarker};var centerMarker=new google.maps.Marker(markerOptions);$view.data('centerMarker',centerMarker);var radiusMarker=new google.maps.Marker(markerOptions);$view.data('radiusMarker',radiusMarker);$view.data('center',false);this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){if($view.data('center')){var radius=google.maps.geometry.spherical.computeDistanceBetween(circle.getCenter(),ev.latLng);circle.setRadius(radius);circle.setMap(map);radiusMarker.setPosition(ev.latLng);radiusMarker.setMap(map);self.exec('geo_radius','updateInfo',[$view,circle]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[2]);}else{circle.setCenter(ev.latLng);centerMarker.setPosition(ev.latLng);centerMarker.setMap(map);$view.data('center',true);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[1]);}
$view.find('.jcsdl-clear-map').fadeIn();});google.maps.event.addListener(centerMarker,'position_changed',function(){var center=this.getPosition();var oldCenter=circle.getCenter();circle.setCenter(center);if(oldCenter!==undefined){var latDiff=center.lat()-oldCenter.lat();var lngDiff=center.lng()-oldCenter.lng();var oldPosition=radiusMarker.getPosition();var position=new google.maps.LatLng(oldPosition.lat()+latDiff,oldPosition.lng()+lngDiff);radiusMarker.setPosition(position);}});google.maps.event.addListener(radiusMarker,'position_changed',function(){var center=circle.getCenter();if(center!==undefined){circle.setRadius(google.maps.geometry.spherical.computeDistanceBetween(circle.getCenter(),this.getPosition()));self.exec('geo_radius','updateInfo',[$view,circle]);}});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();circle.setCenter(null);circle.setMap(null);centerMarker.setMap(null);radiusMarker.setMap(null);$view.data('center',false);$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this;var $geoView=$view.find('.jcsdl-input-geo');val=val.split(':');var latlng=val[0].split(',');var radius=parseFloat(val[1])*1000;setTimeout(function(){var map=$geoView.data('map');var circle=$geoView.data('circle');var center=new google.maps.LatLng(latlng[0],latlng[1])
var centerMarker=$geoView.data('centerMarker');centerMarker.setPosition(center);centerMarker.setMap(map);var radiusMarker=$geoView.data('radiusMarker');var radiusPosition=google.maps.geometry.spherical.computeOffset(center,radius,90);radiusMarker.setPosition(radiusPosition);radiusMarker.setMap(map);circle.setCenter(center);circle.setRadius(radius);circle.setMap(map);$geoView.data('center',true);map.fitBounds(circle.getBounds());self.exec('geo_radius','updateInfo',[$geoView,circle]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_radius.instructions[2]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var circle=$view.find('.jcsdl-input-geo').data('circle');if(!circle.getMap())return'';var center=circle.getCenter();return center.lat()+','+center.lng()+':'+(circle.getRadius()/1000);},displayValue:function(info,val,filter){val=val.split(':');var center=val[0].split(',');var radius=val[1];return'Center: '+parseFloat(center[0]).format(2)+', '+parseFloat(center[1]).format(2)+'; Radius: '+parseFloat(radius).format(2)+' km';},updateInfo:function($view,circle){var r=circle.getRadius();var area=r*r*Math.PI;$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');var center=circle.getCenter();$view.find('.jcsdl-map-coordinates .center span').html(center.lat().format(2)+', '+center.lng().format(2));$view.find('.jcsdl-map-coordinates .radius span').html((circle.getRadius()/1000).format(2)+' km');}},geo_polygon:{init:function(info){var $view=this.getTemplate('valueInput_geopolygon');$view.append(this.getTemplate('valueInput_geo_map'));$view.find('.jcsdl-map-coordinates').html(this.getTemplate('valueInput_geopolygon_coordinates'));$view.find('.jcsdl-map-instructions').html(this.definition.inputs.geo_polygon.instructions[0]);loadGoogleMapsApi(this.gui,this.exec,['geo_polygon','load',[info,$view]]);return $view;},load:function(info,$view){var self=this;var map=new google.maps.Map($view.find('.jcsdl-map-canvas')[0],jcsdlMapsOptions);$view.data('map',map);var opt=$.extend({},this.gui.config.mapsOverlay,{paths:[[]],editable:true});var polygon=new google.maps.Polygon(opt);var path=polygon.getPath();$view.data('polygon',polygon);var markers=new google.maps.MVCArray();$view.data('markers',markers);var mc=1;this._geo.initSearch($view);google.maps.event.addListener(map,'click',function(ev){path.push(ev.latLng);});google.maps.event.addListener(path,'insert_at',function(i){var marker=new google.maps.Marker({map:map,position:path.getAt(i),draggable:true,icon:self.gui.config.mapsMarker,zIndex:mc++});markers.insertAt(i,marker);if(path.getLength()>=3){polygon.setMap(map);}
var instr=(path.getLength()<=3)?path.getLength():3;$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[instr]);self.exec('geo_polygon','updateInfo',[$view,polygon]);$view.find('.jcsdl-clear-map').fadeIn();google.maps.event.addListener(marker,'position_changed',function(ev){var p=self.exec('geo_polygon','getMarkerIndex',[marker,markers]);if(p==-1)return;path.setAt(p,this.getPosition());self.exec('geo_polygon','updateInfo',[$view,polygon]);});google.maps.event.addListener(marker,'dblclick',function(ev){var p=self.exec('geo_polygon','getMarkerIndex',[marker,markers]);if(p==-1)return;path.removeAt(p);markers.removeAt(p);this.setMap(null);self.exec('geo_polygon','updateInfo',[$view,polygon]);});});google.maps.event.addListener(path,'set_at',function(i){var mark=markers.getAt(i),pos=path.getAt(i);if(!mark.getPosition().equals(pos)){mark.setPosition(pos);}});$view.find('.jcsdl-clear-map').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();markers.forEach(function(marker,i){marker.setMap(null);});markers.clear();path.clear();self.exec('geo_polygon','updateInfo',[$view,polygon]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[0]);$(this).hide();});},setValue:function($view,info,val,operator){var self=this;var $geoView=$view.find('.jcsdl-input-geo');val=val.split(':');setTimeout(function(){var polygon=$geoView.data('polygon');var map=$geoView.data('map');$.each(val,function(i,v){v=v.split(',');var pos=new google.maps.LatLng(parseFloat(v[0]),parseFloat(v[1]));polygon.getPath().push(pos);});map.fitBounds(polygon.getBounds());self.exec('geo_polygon','updateInfo',[$geoView,polygon]);$view.find('.jcsdl-map-instructions').html(self.definition.inputs.geo_polygon.instructions[3]);$view.find('.jcsdl-clear-map').fadeIn();},this.gui.config.animate+200);},getValue:function($view,info,operator){var pth=$view.find('.jcsdl-input-geo').data('polygon').getPath(),v=[];pth.forEach(function(p,i){v.push(p.lat()+','+p.lng());});return v.join(':');},displayValue:function(info,val,filter){val=val.split(':');var output=[];$.each(val,function(i,v){v=v.split(',');output.push(parseFloat(v[0]).format(2)+', '+parseFloat(v[1]).format(2));if(i==1)return false;});output=output.join(' : ');if(val.length>2){output+=' and '+(val.length-2)+' more...';}
return output;},getMarkerIndex:function(mrk,mrks){var p=-1;mrks.forEach(function(m,k){if(m.getZIndex()==mrk.getZIndex())p=k;});return p;},updateInfo:function($view,polygon){var path=polygon.getPath();var $list=$view.find('.jcsdl-map-coordinates ul').html('');path.forEach(function(p,i){$('<li />').html('('+p.lat().format(4)+', '+p.lng().format(4)+')').appendTo($list);});if(path.getLength()>=3){var area=google.maps.geometry.spherical.computeArea(path);$view.find('.jcsdl-map-area span').html(Math.round(area/1000000).format()+' km<sup>2</sup>');}else{$view.find('.jcsdl-map-area span').html('0 km<sup>2</sup>');}}}};});
;JCSDL.Loader.addComponent(function($,undefined){var JCSDLCarousel=function($el,options){var self=this;this.select=options.select;this.$carousel=$el.find('.jcsdl-carousel');this.$carouselWrap=this.$carousel.closest('.jcsdl-carousel-wrap');this.$carouselItems=this.$carousel.find('.jcsdl-carousel-item');this.$scrollLeft=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.left');this.$scrollRight=this.$carouselWrap.siblings('.jcsdl-carousel-scroll.right');this.itemsCount=this.$carouselItems.filter(':visible').length;var $exampleItem=this.$carouselItems.eq(0),hideExample=($exampleItem.is(':visible'))?false:true;$exampleItem.show();this.itemWidth=$exampleItem.outerWidth(true);this.itemMargin=parseInt($exampleItem.css('marginRight'));this.$carouselWrap.css({maxWidth:this.calculateWrapWidth(),height:$exampleItem.outerHeight(true)});this.$carousel.css({position:'relative',width:this.itemWidth*this.itemsCount,height:$exampleItem.outerHeight(true)});this.margin=this.calculateCenterMargin();if(hideExample)$exampleItem.hide();var $selected=this.$carouselItems.filter('.selected');this.selectedIndex=($selected.length==1)?$selected.prevAll(':visible').length:Math.floor(this.itemsCount/2);if(this.itemsCount%2==0){this.selectedIndex=this.selectedIndex-0.5;}
this.changePosition(0,!options.expand);this.$carouselWrap.siblings('.jcsdl-carousel-scroll').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $scroll=$(this);if($scroll.hasClass('inactive'))return;var changeIndex=$scroll.is('.left')?-1:1;if(self.selectedIndex-Math.floor(self.selectedIndex)==0.5){self.selectedIndex=(changeIndex<0)?self.selectedIndex:self.selectedIndex-1;}
self.selectedIndex=Math.round(self.selectedIndex)+changeIndex;self.changePosition(options.speed);});this.$carouselItems.bind('mousedown.jcsdlcarousel touchstart.jcsdlcarousel',function(ev){ev.preventDefault();ev.target.blur();var $el=$(this);var moving=false;var pageX=(ev.type=='touchmove')?ev.originalEvent.targetTouches[0].pageX:ev.pageX;$('body').bind('mousemove.jcsdlcarousel touchmove.jcsdlcarousel',function(ev){moving=true;var evPageX=(ev.type=='touchmove')?ev.originalEvent.targetTouches[0].pageX:ev.pageX;var curLeft=parseInt(self.$carousel.css('left'));self.$carousel.css('left',curLeft-(pageX-evPageX));pageX=evPageX;});$('body').bind('mouseup.jcsdlcarousel touchend.jcsdlcarousel',function(ev){if(moving){self.snapToSelection();}else{self.selectedIndex=$el.prevAll(':visible').length;self.changePosition(options.speed);moving=false;}
$('body').unbind('mousemove.jcsdlcarousel touchmove.jcsdlcarousel');$('body').unbind('mouseup.jcsdlcarousel touchend.jcsdlcarousel');});});this.$carouselItems.bind('jcsdlclick',function(ev){$(this).show();self.itemsCount=self.$carouselItems.filter(':visible').length;self.$carousel.css('width',self.itemWidth*self.itemsCount);$(this).trigger('mousedown').trigger('mouseup');});this.$carouselItems.click(function(ev){ev.preventDefault();ev.target.blur();if($.browser.msie){self.selectedIndex=$(this).prevAll(':visible').length;self.changePosition(options.speed);}});$(window).resize(function(ev){self.adjust();});if(this.$carouselItems.filter(':visible').length==1){}}
JCSDLCarousel.prototype={calculateWrapWidth:function(){return this.$carouselWrap.closest('.jcsdl-step').width()-this.$scrollLeft.outerWidth(true)-this.$scrollRight.outerWidth(true);},calculateCenterMargin:function(){this.margin=(this.$carouselWrap.width()-this.itemWidth+this.itemMargin)/2;return this.margin;},calculateCurrentPosition:function(){return-1*this.itemWidth*this.selectedIndex+this.margin;},toggleScrollButtons:function(){this.$scrollLeft.removeClass('inactive');this.$scrollRight.removeClass('inactive');if(this.selectedIndex==0)this.$scrollLeft.addClass('inactive');if(this.selectedIndex+1>=this.itemsCount)this.$scrollRight.addClass('inactive');},getSelectedItem:function(){return this.$carouselItems.filter(':visible').eq(this.selectedIndex);},snapToSelection:function(){var position=parseInt(this.$carousel.css('left'));this.selectedIndex=Math.round((position-this.margin)/(-1*this.itemWidth));this.selectedIndex=(this.selectedIndex<0)?0:this.selectedIndex;this.selectedIndex=(this.selectedIndex+1>this.itemsCount)?this.itemsCount-1:this.selectedIndex;this.changePosition(100);},changePosition:function(speed,dontExpand){var self=this;dontExpand=dontExpand||false;this.$carousel.animate({left:this.calculateCurrentPosition()},speed,function(){self.adjust();});this.toggleScrollButtons();if(!dontExpand&&typeof(this.select)=='function'&&this.itemsCount>0){this.select.apply(this.getSelectedItem());}},adjust:function(){this.$carouselWrap.css({maxWidth:this.calculateWrapWidth()});this.calculateCenterMargin();this.$carousel.css({left:this.calculateCurrentPosition()});}};$.fn.jcsdlCarousel=function(options){function get($el){var carousel=$el.data('jcsdlCarousel');if(!carousel){carousel=new JCSDLCarousel($el,options);$el.data('jcsdlCarousel',carousel);}
return carousel;}
if(typeof(options)=='string'){if($.inArray(options,['adjust'])>=0){this.each(function(){var carousel=get($(this));carousel[options].apply(carousel,[]);});}
return this;}
options=$.extend({},{select:function(){},expand:false,speed:200},options);this.each(function(){get($(this));});return this;};});JCSDL.Loader.addComponent(function($,undefined){$.fn.jcsdlNumberMask=function(fl,arr){this.each(function(){$(this).keydown(function(ev){if((ev.which==190||ev.which==110)&&(($(this).val().indexOf('.')>=0)||!fl)){ev.preventDefault();return;}
if(ev.shiftKey||ev.altKey){ev.preventDefault();return;}else if(ev.which==46||ev.which==8||ev.which==9||ev.which==27||ev.which==190||ev.which==110||(ev.which==188&&arr)||(ev.which==65&&ev.ctrlKey===true)||(ev.which>=35&&ev.which<=39)||ev.which==13){return;}else{if((ev.which<48||ev.which>57)&&(ev.which<96||ev.which>105)){ev.preventDefault();}}});});return this;};});JCSDL.Loader.addComponent(function($,undefined){$.fn.jcsdlOrigVal=$.fn.val;$.fn.val=function(value){if(!this[0])return undefined;var $self=$(this[0]);if($self.data('jcsdlTagInput')){if(value!==undefined){$self.jcsdlOrigVal(value);$self.trigger('change');return $self;}}
if(value!==undefined){return $self.jcsdlOrigVal(value);}
return $self.jcsdlOrigVal();};var JCSDLTagInput=function($el,options){var self=this;this.delimeter=options.delimeter;this.numbers=options.numbers;this.floats=options.floats;this.$original=$el;this.$original.data('jcsdlTagInputEnabled',true);this.$wrap=$(this.tpl);this.$inputWrap=this.$wrap.find('.jcsdl-tag-field');this.$input=this.$inputWrap.find('input');this.inputPh=this.$original.attr('placeholder');this.$input.attr('placeholder',this.inputPh);this.$original.hide().data('jcsdlTagValue',[]);this.$wrap.insertAfter(this.$original);this.$inputSizeHelper=$('<div />').addClass('jcsdl-tag-field-helper').css({position:'absolute',left:-9999,bottom:-9999,minWidth:100,width:'auto',textAlign:'left'}).appendTo(this.$inputWrap);if(this.numbers){this.$input.jcsdlNumberMask(this.floats,true);}
this.update();this.$wrap.bind('click touchstart',function(ev){self.$input.focus();});this.$original.bind('change.jcsdltaginput',function(ev){if(self.updating||!$(this).data('jcsdlTagInputEnabled'))return;self.update();});this.$input.blur(function(ev){var val=self.$input.val();if(val.length==0)return;self.addTag(val);});this.$input.bind('paste.jcsdltaginput',function(ev){setTimeout(function(){var val=self.$input.val();if(val.length==0)return;self.addTag(val);},10);});this.$input.bind('keypress.jcsdltaginput',function(ev){var val=$(this).val();if(ev.which==13){ev.preventDefault();self.addTag($(this).val());return;}
self.reposition();});this.$input.bind('keydown.jcsdltaginput',function(ev){if(ev.which==8&&$(this).val().length==0){ev.preventDefault();self.removeTag(self.$wrap.find('.jcsdl-tag:last'));}});this.$input.bind('keyup.jcsdltaginput',function(ev){var val=$(this).val();if(val.charCodeAt(val.length-1)==self.delimeter.charCodeAt(0)){if(val.charAt(val.length-2)=='\\')return;self.addTag(val.substr(0,val.length-1));}});}
JCSDLTagInput.prototype={tpl:['<div class="jcsdl-tag-input">','<div class="jcsdl-tag-field">','<input type="text" />','</div>','</div>'].join(''),tagTpl:['<span class="jcsdl-tag">','<span />','<a href="#" class="jcsdl-tag-remove jcsdl-elements-sprite" title="Remove"></a>','</span>'].join(''),updating:false,delimeter:',',numbers:false,numbersArrVal:[],floats:false,addTag:function(val){this.$input.val('');if(val===undefined||val.length==0)return;var self=this;var $tag=$(this.tagTpl);$tag.find('span').html(val.truncate());$tag.insertBefore(this.$inputWrap);var values=this.$original.data('jcsdlTagValue');values.push(val);this.$original.data('jcsdlTagValue',values);this.$original.val(values.join(this.delimeter));this.$input.attr('placeholder','');$tag.find('a').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.removeTag($tag);});this.reposition();},removeTag:function($tag){if($tag.length==0)return;var i=this.$wrap.find('.jcsdl-tag').index($tag);$tag.remove();var values=this.$original.data('jcsdlTagValue');values.splice(i,1);this.$original.data('jcsdlTagValue',values);this.$original.val(values.join(this.delimeter));if(values.length==0){this.$input.attr('placeholder',this.inputPh);}
this.reposition();},update:function(space){var delimeter=(space)?new RegExp(/[\s,]+/g):this.delimeter;var origVal=this.$original.val();if(origVal.length==0)return;var self=this;this.$original.data('jcsdlTagValue',[]);this.$wrap.find('.jcsdl-tag').remove();this.updating=true;var values=origVal.split(delimeter);var fixedValues=[];$.each(values,function(i,val){if(val===undefined)return true;if(val.charAt(val.length-1)=='\\'){val+=self.delimeter+values[i+1];values.splice(i+1,1);}
fixedValues.push(val);});values=fixedValues;$.each(values,function(i,val){self.addTag(val);});this.updating=false;this.reposition();},reposition:function(){var text=this.$input.val().escapeHtml();if(text.length==0)text=this.$input.attr('placeholder');this.$inputSizeHelper.html(text);this.$input.css({width:this.$inputSizeHelper.width()+32+'px',maxWidth:this.$wrap.width()-30,'font-size':this.$input.css('font-size'),'font-family':this.$input.css('font-family'),'font-weight':this.$input.css('font-weight'),'letter-spacing':this.$input.css('letter-spacing'),whiteSpace:'nowrap'});},enable:function(){if(this.numbers){if(!this.$original.data('jcsdlTagInputEnabled')){this.numbersArrVal[0]=this.$original.val();}else{this.numbersArrVal=this.$original.val().split(this.delimeter);}}
this.$original.data('jcsdlTagInputEnabled',true);if(this.numbers){this.$original.val(this.numbersArrVal.join(this.delimeter));}
this.$original.hide();this.$wrap.show();},disable:function(){if(this.numbers){var val='';if(this.$original.data('jcsdlTagInputEnabled')){this.numbersArrVal=this.$original.val().split(this.delimeter);val=this.numbersArrVal[0];}else{val=this.$original.val();}}
this.$original.data('jcsdlTagInputEnabled',false);if(this.numbers){this.$original.val(val);}
this.$original.show();this.$wrap.hide();}};$.fn.jcsdlTagInput=function(options){function get($el){var tagInput=$el.data('jcsdlTagInput');if(!tagInput){tagInput=new JCSDLTagInput($el,options);$el.data('jcsdlTagInput',tagInput);}
return tagInput;}
if(typeof(options)=='string'){if($.inArray(options,['enable','disable','reposition','update','setDelimeter'])>=0){var argmns=[];$.each(arguments,function(i,arg){if(i==0)return true;argmns.push(arg);});this.each(function(){var tagInput=get($(this));tagInput[options].apply(tagInput,argmns);});}
return this;}
options=$.extend({},{delimeter:',',numbers:false,floats:false},options);this.each(function(){get($(this));});return this;};});JCSDL.Loader.addComponent(function($,undefined){var JCSDLRegExTester=function($el,config){var self=this;this.$el=$el;this.exp=new RegExp();this.$btn=$('<a href="#" class="jcsdl-regex-tester-button jcsdl-elements-sprite">Test</a>').insertAfter(this.$el);this.$wrap=$('<div class="jcsdl-regex-tester"><p>If you want to test whether your regular expression correctly matches the desired strings, click the "Test" button and input example content in the shown field.</p></div>').insertAfter(this.$el).hide();this.$fields=$();this.$fieldsWraps=$();for(var i=1;i<=config.fields;i++){var $field=this.$el.clone().removeClass('orig').show().attr('placeholder','Test your expression against this field...');var $fieldWrap=$('<div class="jcsdl-regex-tester-input-wrap" />').html($field).append('<div class="jcsdl-regex-result jcsdl-elements-sprite" />');$fieldWrap.prependTo(this.$wrap);this.$fields=this.$fields.add($field);this.$fieldsWraps=this.$fieldsWraps.add($fieldWrap);}
this.$btn.bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.$fieldsWraps.fadeIn();$(this).addClass('active');});this.$el.bind('keyup change',function(ev){self.val=self.$el.val();self.test();});this.$fields.bind('keyup',function(ev){self.test($(this));});this.disable();};JCSDLRegExTester.prototype={mode:'partial',val:'',test:function($fields){var self=this;var $fields=($fields!==undefined)?$fields:this.$fields;var pattern=this.val.replace(/\//g,'\/');var exp=(this.mode=='partial')?''+pattern+'':'^'+pattern+'$';this.exp=new RegExp(exp,'i');$fields.each(function(i,field){if($(field).val().length==0||self.val.length==0){$(field).siblings('.jcsdl-regex-result').hide();return true;}
var result=(self.exp.test($(field).val()))?'ok':'err';$(field).siblings('.jcsdl-regex-result').removeClass('ok err').addClass(result).fadeIn();});},enable:function(){this.$el.data('jcsdlRegExTesterEnabled',true);this.$el.addClass('jcsdl-regex-active');this.$wrap.fadeIn();this.$btn.fadeIn();},disable:function(){this.$el.data('jcsdlRegExTesterEnabled',false);this.$el.removeClass('jcsdl-regex-active');this.$wrap.hide();this.$fieldsWraps.hide();this.$btn.hide();},setPartial:function(){this.mode='partial';},setExact:function(){this.mode='exact';}};$.fn.jcsdlRegExTester=function(options){function get($el){var tester=$el.data('jcsdlRegExTester');if(!tester){tester=new JCSDLRegExTester($el,options);$el.data('jcsdlRegExTester',tester);}
return tester;}
if(typeof(options)=='string'){if($.inArray(options,['enable','disable','setPartial','setExact','test'])>=0){this.each(function(){var tester=get($(this));tester[options].apply(tester,[]);});}
return this;}
options=$.extend({},{fields:1},options);this.each(function(){get($(this));});return this;}});JCSDL.Loader.addComponent(function($,undefined){var JCSDLPopup=function(config){var self=this;this.config=$.extend({},this.config,config);this.$overlay=$('<div class="jcsdl-overlay" />').appendTo('body').hide();this.$popup=$(['<div class="jcsdl-popup">','<div class="jcsdl-popup-header jcsdl-elements-sprite">','<h4 />','<a href="#" class="jcsdl-popup-close jcsdl-elements-sprite">Close</a>','</div>','<div class="jcsdl-popup-content" />','</div>'].join('')).appendTo('body').hide();if(this.config.title)this.setTitle(this.config.title);if(this.config.content)this.setContent(this.config.content);this.$popup.css({minWidth:this.config.minWidth,maxWidth:this.config.maxWidth});this.setWidth(this.config.width);if(this.config.autoshow)this.show();this.$popup.find('.jcsdl-popup-close').click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();self.close();});$(window).resize(function(ev){if(self.$popup.is(':visible')){self.reposition();}});};JCSDLPopup.prototype={$popup:$(),$overlay:$(),config:{width:700,minWidth:280,maxWidth:'70%',title:'',content:'<div class="jcsdl-popup-loading"></div>',autoshow:true,overlay:true},getTitle:function(){return this.$popup.find('.jcsdl-popup-header h4').html();},setTitle:function(title){this.$popup.find('.jcsdl-popup-header h4').html(title);this.config.title=title;},getContent:function(){return this.$popup.find('.jcsdl-popup-content');},setContent:function(content){var $content=$(content);var $popupContent=this.$popup.find('.jcsdl-popup-content');$popupContent.html('');$content.each(function(i,el){$popupContent.append($(el));});this.config.content=content;},setWidth:function(width){this.$popup.width(width);},reposition:function(){this.$popup.css('position','absolute');this.$popup.find('.jcsdl-popup-content').css('maxHeight',$(window).height()*0.7);var leftPos=($(window).width()-this.$popup.outerWidth())/2+$(window).scrollLeft();var topPos=($(window).height()-this.$popup.outerHeight())/2+$(window).scrollTop();if(topPos<0)topPos=0;if(leftPos<0)leftPos=0;this.$popup.css({left:leftPos+'px',top:topPos+'px'});},show:function(){if(this.config.overlay)this.$overlay.show();this.$popup.show();this.reposition();},hide:function(){this.$overlay.hide();this.$popup.hide();},close:function(){this.$overlay.remove();this.$popup.remove();}};$.jcsdlPopup=function(config){return new JCSDLPopup(config);};});JCSDL.Loader.addComponent(function($,undefined){$.fn.animateIntoView=function(s,m,c){s=(s===undefined)?200:s;m=parseInt(m)||0;c=(typeof(c)=='function')?c:function(){};var $t=$(this[0]);if(!$t.length)return this;var $b=$('body'),$h=$('html'),t=$t.offset().top,vt=parseInt($b.scrollTop()),vb=vt+$(window).height();if(vt<t&&t<vb)return this;$b.add($h).animate({scrollTop:t-m},s,c);return this;};});var jcsdlMapsLoaded=false;var jcsdlMapsCurrentGui=null;var jcsdlMapsCurrentCallback=function(){};var jcsdlMapsCurrentCallbackArgs=[];var jcsdlMapsOptions={};var loadGoogleMapsApi=function(currentGui,callback,callbackArgs){jcsdlMapsCurrentGui=currentGui;jcsdlMapsCurrentCallback=callback;jcsdlMapsCurrentCallbackArgs=callbackArgs;if(!jcsdlMapsLoaded){var incKey=(jcsdlMapsCurrentGui.config.googleMapsApiKey.length>0)?'key='+jcsdlMapsCurrentGui.config.googleMapsApiKey+'&':'';var incProtocol=(window.location.protocol=='file:')?'http:':'';jQuery('body').append('<script type="text/javascript" src="'+incProtocol+'//maps.googleapis.com/maps/api/js?'+incKey+'libraries=places,geometry&sensor=false&callback=jcsdlMapsInit" />');jcsdlMapsLoaded=true;}else{jcsdlMapsInit();}};var jcsdlMapsInit=function(){jcsdlMapsOptions={center:new google.maps.LatLng(40,0),zoom:1,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:true,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(latLng){var bounds=new google.maps.LatLngBounds();var paths=this.getPaths();var path;for(var p=0;p<paths.getLength();p++){path=paths.getAt(p);for(var i=0;i<path.getLength();i++){bounds.extend(path.getAt(i));}}
return bounds;};}
if(jcsdlMapsCurrentGui&&jcsdlMapsCurrentCallback){setTimeout(function(){jcsdlMapsCurrentCallback.apply(jcsdlMapsCurrentGui.inputs,jcsdlMapsCurrentCallbackArgs);},jcsdlMapsCurrentGui.config.animate+10);}};JCSDL.Loader.addComponent(function($,undefined){$.extend(String.prototype,{truncate:function(l,a,h){l=l||72;a=a||'...';if(this.length<=l)return this.valueOf();s=this.substr(0,l);if(!h){s=s.substr(0,s.lastIndexOf(' '));}
return s+a;},isNumeric:function(){return(!isNaN(parseInt(this.valueOf())));},escapeHtml:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');},unescapeHtml:function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');},escapeCsdl:function(){return this.replace(/\\(?![,:]+)/g,'\\\\').replace(/"/g,'\\"');},unescapeCsdl:function(){return this.replace(/\\"/g,'"').replace(/\\\\/g,'\\');}});$.extend(Number.prototype,{format:function(decimals,dec_point,thousands_sep){var number=this.toString().replace(/[^0-9+\-Ee.]/g,'');var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=(thousands_sep===undefined)?',':thousands_sep,dec=(dec_point===undefined)?'.':dec_point,s='',toFixedFix=function(n,prec){var k=Math.pow(10,prec);return''+Math.round(n*k)/k;};s=(prec?toFixedFix(n,prec):''+Math.round(n)).split('.');if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep);}
if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join('0');}
return s.join(dec);}});});
;JCSDL.Loader.addComponent(function($,undefined){this.GUIFilterEditor=function(gui,$appendTo,filter){$appendTo=$appendTo||$();filter=filter||{};var self=this;this.gui=gui;this.config=gui.config;this.definition=gui.definition;this.parser=gui.parser;this.inputs=gui.inputs;this.getTemplate=gui.getTemplate;this.getIconForField=gui.getIconForField;this.filter=filter;this.steps=[];this.target=null;this.path=[];this.$view=this.getTemplate('filterEditor');this.$steps=this.$view.find('.jcsdl-steps');this.$view.appendTo($appendTo).show();this.addFilterStep('target',this.createTargetSelectView());this.$view.find('.jcsdl-filter-save').hide();this.$view.find('.jcsdl-footer span').hide();this.$view.find('.jcsdl-filter-save').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.didSubmitFilter();});this.$view.find('.jcsdl-filter-cancel').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.gui.hideFilterEditor();self.trigger('filterCancel');});this.loadFilter(filter);};this.GUIFilterEditor.prototype={filter:{},jsonpCache:{operators:{},targets:{}},adjust:function(){this.$steps.find('.jcsdl-step').jcsdlCarousel('adjust');},loadFilter:function(filter){var self=this;this.filter=filter;if(filter===undefined||!filter||filter.target===undefined)return false;var fieldInfo=this.parser.getFieldInfo(filter.target,filter.fieldPath);this.$view.find('.jcsdl-filter-target .target-'+filter.target).trigger('jcsdlclick');$.each(filter.fieldPath,function(i,field){var $fieldView=self.$view.find('.jcsdl-filter-target-field:last');$fieldView.find('.field-'+field).trigger('jcsdlclick');});if(typeof(fieldInfo.input)!=='string'){this.$view.find('.jcsdl-filter-target-field-input .input-'+filter.operator).trigger('jcsdlclick');}
if(fieldInfo.input=='text'){$('.jcsdl-dropdown .jcsdl-dropdown-option.operator-'+filter.operator).click();}else{this.$view.find('.jcsdl-filter-value-input-operators .operator-'+filter.operator).click();}
var $valueInputView=this.$view.find('.jcsdl-filter-value-input-field');this.setValueForField($valueInputView,fieldInfo,filter.value,filter.operator);if(filter.cs){this.$view.find('.jcsdl-operator-cs').click();}},addFilterStep:function(stepName,$view,slide){var self=this,slide=(slide===undefined)?true:slide,$stepView=this.getTemplate('step'),stepNumber=this.steps.length;$stepView.html($view).data('number',stepNumber).addClass('jcsdl-filter-step-number-'+stepNumber).data('name',stepName).addClass('jcsdl-filter-step-'+stepName).appendTo(this.$steps);if(stepName=='target'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);$stepView.addClass('selected').find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectTarget($item.data('name'));}});}
if(stepName=='field'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);self.$steps.find('.jcsdl-filter-step-target').addClass('field-selected');var previousStep=$stepView.data('number')-1;self.$steps.find('.jcsdl-filter-step-field.jcsdl-filter-step-number-'+previousStep).addClass('field-selected');$stepView.addClass('selected').find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectField($item.data('name'),$view,$stepView);}});}
if(stepName=='input'){$stepView.jcsdlCarousel({select:function(){var $item=$(this);var previousStep=$stepView.data('number')-1;self.$steps.find('.jcsdl-filter-step-field.jcsdl-filter-step-number-'+previousStep).addClass('field-selected');$stepView.addClass('selected').find('.jcsdl-carousel-item.selected').removeClass('selected');$item.addClass('selected');self.didSelectInput($item.data('name'),$view,$stepView);}});}
if(stepName=='value'){this.$view.find('.jcsdl-filter-save').fadeIn(this.config.animate);this.$view.find('.jcsdl-footer span').show();}
if(slide){$stepView.hide().slideDown(this.config.animate);}else{if(stepName=='field'){$stepView.find('.jcsdl-filter-target-field').hide().fadeIn(this.config.animate);}else{$stepView.hide().fadeIn(this.config.animate);}}
setTimeout(function(){self.adjust();},this.config.animate);this.steps.push($stepView);},removeFilterStepsAfterPosition:function(position){var $theStep=this.$steps.find('.jcsdl-step').eq(position).removeClass('field-selected'),steps=this.steps.splice(position+1,this.steps.length-position),firstName='';this.$view.find('.jcsdl-filter-save').hide();this.$view.find('.jcsdl-footer span').hide();$.each(steps,function(i,step){var $step=$(step);if(i==0){firstName=$step.data('name');}
$step.remove();});return firstName;},didSelectTarget:function(targetName){if(this.definition.targets[targetName]===undefined)return false;this.target=targetName;this.path=[];var firstRemoved=this.removeFilterStepsAfterPosition(0);var $fieldView=this.createFieldSelectionView(this.definition.targets[targetName].fields);this.addFilterStep('field',$fieldView,(firstRemoved!='field'));this.trigger('targetSelect',[targetName]);},didSelectField:function(fieldName,$fieldView,$stepView){var fieldPosition=$fieldView.data('position');this.path.splice(fieldPosition,this.path.length-fieldPosition);$stepView.removeClass('selected-final').find('.jcsdl-target-help').remove();var field=this.getFieldInfoAtCurrentPath(fieldName);if(field==false)return;var firstRemoved=this.removeFilterStepsAfterPosition($fieldView.closest('.jcsdl-step').data('number'));this.path.push(fieldName);if(field.fields!==undefined){var $fieldView=this.createFieldSelectionView(field.fields),slide=(firstRemoved!='field');this.addFilterStep('field',$fieldView,slide);return;}
if(typeof(field.input)!=='string'){var $inputView=this.createInputSelectionView(field.input),slide=(firstRemoved!='input');this.addFilterStep('input',$inputView,slide);return;}
var $valueView=this.createValueInputView(field);this.addFilterStep('value',$valueView,(firstRemoved!='value'));this.addTargetHelpToStep($stepView);this.trigger('targetSelect',[this.getCurrentPath()]);},didSelectInput:function(inputName,$inputView,$stepView){var inputPosition=$inputView.data('position'),firstRemoved=this.removeFilterStepsAfterPosition($inputView.closest('.jcsdl-step').data('number'));$stepView.removeClass('selected-final').find('.jcsdl-target-help').remove();var $valueView=this.createValueInputView(this.getFieldInfoAtCurrentPath(),inputName);this.addFilterStep('value',$valueView,(firstRemoved!='value'));this.addTargetHelpToStep($stepView);},addTargetHelpToStep:function($stepView){var self=this;this.getTemplate('targetHelp').appendTo($stepView);$stepView.find('.jcsdl-target-help').click(function(ev){ev.preventDefault();ev.target.blur();var info=self.getFieldInfoAtCurrentPath(),target=self.target,targetInfo=self.parser.getTargetInfo(target);path=self.path.join('-'),title=targetInfo.name,cPath=[];$.each(self.path,function(i,name){cPath.push(name);title+=' &raquo; '+self.parser.getFieldInfo(target,cPath).name;});var cacheName=path;if(target!='augmentation'){cacheName=target+'.'+cacheName;}
var url=self.config.targetHelpUrl.apply(self,[cacheName.replace(/-/g,'.'),info]),popup=$.jcsdlPopup({title:title});if(self.jsonpCache.targets[cacheName]===undefined){$.ajax({url:url,type:'GET',async:false,jsonpCallback:'jcsdlJSONP',contentType:'application/json',dataType:'jsonp',success:function(data){if(!data||!data.html||!$.trim(data.html)){popup.setContent('<p>No documentation available.</p>');popup.reposition();return;}
popup.setContent(data.html);popup.reposition();self.jsonpCache.targets[cacheName]=data.html;},error:function(){popup.setContent('<p>No documentation available.</p>');popup.reposition();}});}else{popup.setContent(self.jsonpCache.targets[cacheName]);popup.reposition();}});},didSubmitFilter:function(){var filterInfo=this.getFilterInfo();if(filterInfo){this.gui.didSubmitFilter(filterInfo);}},showError:function(message,code){this.$view.find('.jcsdl-error').remove();var $error=this.getTemplate('error');$error.find('span').html(message);$error.prependTo(this.$view.find('.jcsdl-footer')).hide().fadeIn();if(console!==undefined){console.error(message,arguments);}},trigger:function(name,data){this.gui.trigger(name,data);},createTargetSelectView:function(){var self=this,$targetSelectView=this.getTemplate('target'),$targetSelect=$targetSelectView.find('.jcsdl-filter-target');$.each(this.definition.targets,function(name,target){var $targetView=self.createOptionForTarget(name,target);$targetView.appendTo($targetSelect);});return $targetSelectView;},createOptionForTarget:function(name,target){var $option=this.getTemplate('targetOption').data('name',name).data('target',target).addClass('target-'+name);if($.inArray(name,this.config.hideTargets)>=0){$option.addClass('jcsdl-option-hidden');if(this.filter.target===undefined||this.filter.target!==name){$option.hide();}}
return $option;},createFieldSelectionView:function(fields){var self=this,fieldPosition=this.path.length,currentPath=this.target+(this.path.length>0?'.'+this.path.join('.'):''),$fieldView=this.getTemplate('field'),hidden=false,path=$.merge([this.target],this.path),cPath='';$fieldView.data('position',fieldPosition).addClass('field-select-'+fieldPosition);$.each(path,function(i,target){cPath=cPath+(i>0?'.':'')+target;if($.inArray(cPath,self.config.hideTargets)>=0){hidden=true;return true;}});var $fieldSelect=$fieldView.find('.jcsdl-filter-target-field');$.each(fields,function(name,field){var $fieldView=self.createOptionForField(name,field,currentPath,hidden);$fieldView.appendTo($fieldSelect);});return $fieldView;},createOptionForField:function(name,fieldInfo,parentPath,hidden){var self=this,$option=this.getTemplate('fieldOption').data('name',name).data('field',fieldInfo).html(fieldInfo.name).addClass('icon-'+this.getIconForField(name,fieldInfo)).addClass('field-'+name);if(!hidden){var path=parentPath+'.'+name;if($.inArray(path,self.config.hideTargets)>=0){hidden=true;}else{path=path.split('-');var sectionPath='';$.each(path,function(i,section){sectionPath+=(i>0?'.':'')+section;if($.inArray(sectionPath,self.config.hideTargets)>=0){hidden=true;return true;}});}}
if(hidden){$option.addClass('jcsdl-option-hidden');}
if(hidden&&this.filter&&this.filter.target!==undefined&&this.filter.fieldPath!==undefined){var cFilterPath=this.filter.target+'.'+this.filter.fieldPath.join('.').replace(/-/g,'.'),cPath=parentPath+'.'+name;if(cFilterPath==cPath){hidden=false;}}
if(hidden){$option.hide();}
return $option;},createInputSelectionView:function(inputs){var self=this,$inputView=this.getTemplate('inputSelect'),$inputSelect=$inputView.find('.jcsdl-filter-target-field-input');$.each(inputs,function(i,name){var $inputOptionView=self.createOptionForInput(name);$inputOptionView.appendTo($inputSelect);});return $inputView;},createOptionForInput:function(name){var $option=this.getTemplate('inputSelectOption').data('name',name).addClass('icon-'+name+' input-'+name).html(name);return $option;},createValueInputView:function(field,inputType){inputType=inputType||field.input;var self=this,$valueView=this.getTemplate('valueInput');if(this.inputs[inputType]===undefined)return $valueView;var $inputView=this.inputs.exec(inputType,'init',[field]),$input=$inputView.find('input:first'),$valueInput=$valueView.find('.jcsdl-filter-value-input-field').data('inputType',inputType).html($inputView),$operatorsListView=$valueView.find('.jcsdl-filter-value-input-operators');if(inputType=='text'){this.createTextOperatorsSelectView($operatorsListView,field,inputType,$valueInput);}else{this.createOperatorsSelectView($operatorsListView,field,inputType,$valueInput);}
return $valueView;},createOperatorsSelectView:function($view,field,inputType,$inputView){var self=this,$input=$inputView.find('input:first'),inputConfig=(this.definition.inputs[inputType]!==undefined)?this.definition.inputs[inputType]:{},allowedOperators=(inputConfig.operators!==undefined)?inputConfig.operators:[];$.each(field.operators,function(i,operator){if(allowedOperators.length>0&&($.inArray(operator,allowedOperators)==-1))return true;var $operatorView=self.createOperatorOptionView(operator);if($.browser.msie){$operatorView.html('&nbsp;');}
$view.append($operatorView);});$view.children().bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $operator=$(this),opName=$operator.data('name');$view.children().removeClass('selected');$operator.addClass('selected');if(opName=='exists'){$inputView.fadeOut(self.config.animate);}else if(!$inputView.is(':visible')){$inputView.fadeIn(self.config.animate);}
if(inputType=='number'){var tagAction=($.inArray(opName,inputConfig.arrayOperators)>=0)?'enable':'disable';$input.jcsdlTagInput(tagAction);}
self.trigger('operatorSelect',[opName]);});if($view.children().length==1){$view.children().eq(0).click();$view.children().hide();}else{var preselect=(field.operator!==undefined)?field.operator:inputConfig.operator,$preselect=$view.find('.operator-'+preselect);if($preselect.length>0){$preselect.click();}else{$view.find('.operator:not(.operator-exists):first').click();}}
return $view;},createTextOperatorsSelectView:function($view,field,inputType,$inputView){var self=this;$('.jcsdl-dropdown').remove();$view.addClass('text');var $input=$inputView.find('input.orig'),$select=this.getTemplate('textOperatorsSelect'),$dropdown=this.getTemplate('textOperatorsDropdown'),inputConfig=(this.definition.inputs[inputType]!==undefined)?this.definition.inputs[inputType]:{},allowedOperators=(inputConfig.operators!==undefined)?inputConfig.operators:[];$.each(field.operators,function(i,operator){if(allowedOperators.length>0&&($.inArray(operator,allowedOperators)==-1))return true;var $operatorView=self.createTextOperatorOptionView(operator);$dropdown.append($operatorView);});$view.html($select).insertAfter($inputView);$dropdown.hide().appendTo('body');if(field.cs){var $csView=this.getTemplate('caseSensitivity');$csView.bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();$(this).toggleClass('selected');self.trigger('caseSensitivityChange',[$(this).is('.selected')]);}).tipsy({gravity:'s',offset:9});$csView.prependTo($view);$select.addClass('has-cs');}
$select.click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();if($select.hasClass('active')){$dropdown.slideUp(self.config.animate);$select.removeClass('active');}else{$dropdown.css({top:$select.offset().top+$select.outerHeight()-1,left:$select.offset().left,width:$select.outerWidth()-2}).slideDown(self.config.animate);$select.addClass('active');$('body').bind('click.jcsdldropdown',function(ev){var $parent=$(ev.target).closest('.jcsdl-dropdown');if($parent==null||!$parent.is('.jcsdl-dropdown')){$select.removeClass('active');$dropdown.slideUp(self.config.animate);$('body').unbind('click.jcsdldropdown');}});}});$dropdown.find('.jcsdl-dropdown-details-trigger, .jcsdl-operator-help').click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();var $option=$(this).closest('.jcsdl-dropdown-option'),name=$option.data('name'),popup=$.jcsdlPopup({title:$option.data('title')});if(self.jsonpCache.operators[name]===undefined){$.ajax({url:$option.data('jsonp'),type:'GET',async:false,jsonpCallback:'jcsdlJSONP',contentType:'application/json',dataType:'jsonp',success:function(data){if(!data||!data.html||!$.trim(data.html)){popup.setContent('<p>No documentation available.</p>');popup.reposition();return;}
popup.setContent(data.html);popup.reposition();self.jsonpCache.operators[name]=data.html;}});}else{popup.setContent(self.jsonpCache.operators[name]);popup.reposition();}});$dropdown.find('.jcsdl-dropdown-option').click(function(ev){ev.preventDefault();ev.target.blur();$select.removeClass('active');$dropdown.hide();var name=$(this).data('name'),operator=self.definition.operators[name];$select.data('operator',name).find('.jcsdl-operator-label').html(operator.label);if(name=='exists'){$inputView.fadeOut(self.config.animate);if(field.cs){$csView.fadeOut(self.config.animate);}}else if(!$inputView.is(':visible')){$inputView.fadeIn(self.config.animate);if(field.cs){$csView.fadeIn(self.config.animate);}}
if(name=='contains_near'){$inputView.find('.jcsdl-containsnear-distance').fadeIn();$inputView.find('.jcsdl-tag-field input').bind('keydown.nospace',function(ev){if(ev.which==32){ev.preventDefault();return;}});$input.jcsdlTagInput('update',true);$input.data('split',true);}else{$inputView.find('.jcsdl-containsnear-distance').hide();$inputView.find('.jcsdl-tag-field input').unbind('keydown.nospace');if($input.data('split')){$input.jcsdlTagInput('update');$input.data('split',false);}}
var tagAction=($.inArray(name,inputConfig.arrayOperators)>=0)?'enable':'disable';$input.jcsdlTagInput(tagAction);if(tagAction=='enable'){$input.jcsdlTagInput('update');}
var regExAction=($.inArray(name,['regex_partial','regex_exact'])>=0)?'enable':'disable';$input.jcsdlRegExTester(regExAction);if(regExAction=='enable'){var regExSetting=(name=='regex_partial')?'Partial':'Exact';$input.jcsdlRegExTester('set'+regExSetting);$input.jcsdlRegExTester('test');}
self.trigger('operatorSelect',[name]);});$(window).resize(function(ev){if(!$select.hasClass('active'))return;$dropdown.css({top:$select.offset().top+$select.outerHeight()-1,left:$select.offset().left,width:$select.outerWidth()-2});});if($dropdown.find('.jcsdl-dropdown-option').length==1){$dropdown.find('.jcsdl-dropdown-option:first').click();}else{var preselect=(field.operator!==undefined)?field.operator:inputConfig.operator,$preselect=$dropdown.find('.jcsdl-dropdown-option.operator-'+preselect);if($preselect.length>0){$preselect.click();}else{$dropdown.find('.jcsdl-dropdown-option:not(.operator-exists):first').click();}}
return $view;},createOperatorOptionView:function(name){var operator=this.definition.operators[name];if(operator===undefined)return $();var $operatorView=this.getTemplate('operatorOption').data('name',name).addClass('icon-'+name+' operator-'+name).attr('title',operator.description).html(operator.label).tipsy({gravity:'s',offset:9});return $operatorView;},createTextOperatorOptionView:function(name){var operator=this.definition.operators[name];if(operator===undefined)return $();var $view=this.getTemplate('textOperatorOption').data('name',name).data('title',operator.label).addClass('operator-'+name);$view.find('.jcsdl-icon').addClass('icon-'+name+' operator-'+name+' selected');$view.find('.jcsdl-operator-label span').html(operator.label);$view.find('.jcsdl-operator-desc').html(operator.description);if(operator.jsonp){$view.data('jsonp',operator.jsonp);}else{$view.find('.jcsdl-dropdown-details-trigger').remove();$view.find('.jcsdl-operator-help').remove();}
return $view;},setValueForField:function($view,fieldInfo,value,operator){var self=this,inputType=$view.data('inputType');if(this.inputs[inputType]===undefined)return false;if($.inArray(inputType,['geo_box','geo_radius','geo_polygon'])>=0){var mapsGui=jcsdlMapsCurrentGui,mapsCallback=jcsdlMapsCurrentCallback,mapsCallbackArgs=jcsdlMapsCurrentCallbackArgs;jcsdlMapsCurrentCallback=function(){if(mapsGui&&mapsCallback){setTimeout(function(){mapsCallback.apply(mapsGui.inputs,mapsCallbackArgs);self.inputs.exec(inputType,'setValue',[$view,fieldInfo,value,operator]);},mapsGui.config.animate+10);}};}else{this.inputs.exec(inputType,'setValue',[$view,fieldInfo,value,operator]);}
return true;},getValueFromField:function($view,fieldInfo,operator){var inputType=$view.data('inputType');if(this.inputs[inputType]===undefined)return'';return this.inputs.exec(inputType,'getValue',[$view,fieldInfo,operator]);},getView:function(){return this.$view;},getFilterInfo:function(){var fieldInfo=this.getFieldInfoAtCurrentPath();var operator=(fieldInfo.input=='text')?this.$view.find('.jcsdl-filter-value-input-operators .jcsdl-operators-select').data('operator'):this.$view.find('.jcsdl-filter-value-input-operators .operator.selected').data('name');if(operator===undefined){this.showError('You need to select an operator!');return;}
var value='';if(operator!=='exists'){var $valueView=this.$view.find('.jcsdl-filter-value-input-field');value=this.getValueFromField($valueView,fieldInfo,operator);if(value.length==0){this.showError('You need to specify a value!');return;}}
var filterInfo={target:this.target,path:this.path,operator:operator,value:value,additional:{cs:((operator!=='exists')&&fieldInfo.cs&&this.$view.find('.jcsdl-operator-cs.selected').length>0)?true:false}};return filterInfo;},getFieldInfoAtCurrentPath:function(newFieldName){var fieldsPath=this.path.slice(0);if(typeof(newFieldName)=='string'){fieldsPath.push(newFieldName);}
return this.parser.getFieldInfo(this.target,fieldsPath);},getCurrentPath:function(){return this.target+(this.path.length>0?'.':'')+this.path.join('.').replace(/-/g,'.');}};});
;JCSDL.Loader.addComponent(function($,undefined){this.GUILogic=function(gui,logic){var self=this;this.gui=gui;this.config=gui.config;this.parser=gui.parser;this.getTemplate=gui.getTemplate;this.$logicOptions=gui.$mainView.find('.jcsdl-filters-logic .jcsdl-filters-logic-option:not(.jcsdl-advanced-option)');this.$advancedOptions=gui.$mainView.find('.jcsdl-filters-logic .jcsdl-filters-logic-option.jcsdl-advanced-option');this.$insertBracketsButton=this.$advancedOptions.filter('.jcsdl-advanced-add-brackets');this.$editor=gui.$mainView.find('.jcsdl-advanced-container');this.$guiContainer=this.initGui(this.$editor.find('.jcsdl-advanced-gui-container'));this.$gui=this.$guiContainer.find('.jcsdl-advanced-gui');this.$manual=this.$editor.find('.jcsdl-advanced-manual');this.$manualInput=this.initManualInput(this.$manual.find('input'));this.$logicOptions.click(function(ev){ev.preventDefault();ev.target.blur();var $el=$(this);if($el.is('.disabled')||$el.is('.active'))return false;self.$logicOptions.removeClass('active');$el.addClass('active');self.logic=$el.data('logic');self.trigger('logicChange',[self.logic]);if(self.logic==self.ADVANCED){self.showEditor();self.$logicOptions.not('.jcsdl-advanced').each(function(){var $el=$(this);$el.html($el.data('textShort'));});self.$advancedOptions.fadeIn(self.config.animate);}else{self.clearErrors();self.hideEditor();self.$logicOptions.not('.jcsdl-advanced').each(function(){var $el=$(this);$el.html($el.data('textLong'));});self.$advancedOptions.hide();}});this.$logicOptions.filter('.jcsdl-advanced').find('.jcsdl-logic-help').tipsy({gravity:'s',trigger:'manual',title:function(){if(self.$editor.is(':visible')){return $(this).data(self.$manual.is(':visible')?'textManual':'textGui');}else{return $(this).data('textGeneral');}}}).click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation();var $el=$(this);$el.tipsy('show');$('body').one('click',function(ev){$el.tipsy('hide');});});this.$advancedOptions.filter('.jcsdl-advanced-manual-edit').click(function(ev){ev.preventDefault();ev.target.blur();var $el=$(this);if($el.is('.on')){try{self.validate(self.getManualString());}catch(e){self.showError(e);return;}
$el.removeClass('on');$el.html($el.data('textGui'));self.$manualInput.blur();self.$manual.hide();self.$guiContainer.fadeIn(self.config.animate);self.$insertBracketsButton.removeClass('disabled');self.setGuiString();}else{try{self.validate(self.getGuiString());}catch(e){self.showError(e);return;}
$el.addClass('on');$el.html($el.data('textManual'));self.setManualString();self.$guiContainer.hide();self.$manual.fadeIn(self.config.animate);self.$manualInput.focus();self.$insertBracketsButton.addClass('disabled');}});try{this.setLogic(logic);}catch(e){this.showError(e,true);}};this.GUILogic.prototype={ADVANCED:'ADVANCED',AND:'AND',OR:'OR',tokenize:function(logicString){logicString=logicString||this.logicString;return this.parser.tokenizeLogicString(logicString);},validate:function(logicString,availableFilters){logicString=logicString||this.logicString;availableFilters=availableFilters||this.gui.filters;return this.parser.validateLogic(logicString,availableFilters);},showEditor:function(){this.$editor.show();this.adjustGui();this.$editor.hide().slideDown(this.config.animate);},hideEditor:function(){this.$editor.slideUp(this.config.animate);},toggleButtons:function(on){on=(on===undefined)?true:on;if(!on){this.setLogic(this.AND);}
this.$logicOptions[on?'removeClass':'addClass']('disabled');},showError:function(error,silent){silent=silent||false;this.clearErrors();var message=(error instanceof JCSDL.LogicValidationException)?error.message:error;var $error=this.getTemplate('error');$error.find('span').html(message);$error.insertAfter(this.$editor);$error.show();if(!silent&&console!==undefined){console.error(error,arguments);}
if(error instanceof JCSDL.LogicValidationException&&this.$gui.is(':visible')){if(error.index>=0){var $token=this.$gui.children().not('.jcsdl-token-ph').eq(error.index).find('.jcsdl-logic-token').addClass('error');this.scrollGuiToToken($token);}}
$error.animateIntoView(this.config.animate);},trigger:function(name,data){this.gui.trigger(name,data);},clearErrors:function(){this.gui.clearErrors();this.$gui.find('.error').removeClass('error');},initGui:function($view){var self=this,$gui=$view.find('.jcsdl-advanced-gui'),scrollInterval=null,scrollSpeed=50;this.$guiLeft=$view.find('.jcsdl-advanced-gui-arrow.left');this.$guiRight=$view.find('.jcsdl-advanced-gui-arrow.right');$gui.sortable({cursor:'move',placeholder:'jcsdl-token-ph',containment:this.$editor,appendTo:this.$editor,helper:'clone',tolerance:'intersect',start:function(ev,ui){if(ui.item.find('.jcsdl-logic-token').is('.bracket')){$gui.find('.jcsdl-token-ph').addClass('bracket');}},stop:function(ev,ui){var $token=ui.item.find('.jcsdl-logic-token');if($token.is('.filter')){self.gui.highlightFilter($token.data('token'),false);}},sort:function(ev,ui){clearInterval(scrollInterval);if(self.$guiRight.is(':visible')&&(ui.offset.left+ui.helper.width()/2)>=self.$guiRight.offset().left){scrollInterval=setInterval(function(){self.scrollGui('right',scrollSpeed);},scrollSpeed);}
if(self.$guiLeft.is(':visible')&&ui.offset.left<=(self.$guiLeft.offset().left+ui.helper.width()/2)){scrollInterval=setInterval(function(){self.scrollGui('left',scrollSpeed);},scrollSpeed);}
var $token=ui.helper.find('.jcsdl-logic-token');if($token.is('.filter')){self.gui.highlightFilter($token.html());}},update:function(ev,ui){clearInterval(scrollInterval);setTimeout(function(){self.updateFromGui();},100);}});$gui.data('sortable').floating=true;$gui.data('uiSortable').floating=true;this.$insertBracketsButton.click(function(ev){ev.preventDefault();ev.target.blur();if($(this).is('.disabled'))return false;self.addGuiToken(')',true,true);self.updateFromGui();});this.$guiRight.add(this.$guiLeft).bind('mousedown touchstart',function(ev){var dir=$(this).is('.right')?'right':'left';scrollInterval=setInterval(function(){self.scrollGui(dir,scrollSpeed);},scrollSpeed);}).bind('mouseup mouseleave touchend',function(ev){clearInterval(scrollInterval);}).click(function(ev){ev.preventDefault();ev.target.blur();});$(window).resize(function(ev){self.adjustGui();});return $view;},updateFromGui:function(){var tokens=this.getGuiTokens();try{if(this.validate(tokens)){this.clearErrors();this.logicString=tokens.join('');}}catch(e){this.showError(e,true);}},setGuiString:function(logicString){logicString=logicString||this.logicString;var self=this,tokens=(typeof logicString==='string'||typeof logicString==='number')?this.tokenize(logicString):logicString;this.clearGui();$.each(tokens,function(i,token){self.addGuiToken(token,false);});},getGuiString:function($gui){$gui=$gui||this.$gui;var str='';$gui.find('.jcsdl-logic-token').each(function(){str+=''+$(this).data('token');});return str;},getGuiTokens:function($gui){$gui=$gui||this.$gui;var tokens=[];$gui.find('.jcsdl-logic-token').each(function(){tokens.push($(this).data('token'));});return tokens;},clearGui:function(){this.$gui.width(0).children().remove();},tokensMap:{'(':'bracketOpen',')':'bracketClose','&':'operatorAnd','|':'operatorOr','filter':'filter'},addGuiToken:function(token,scroll,manual){scroll=(scroll===undefined)?true:scroll;manual=(manual===undefined)?false:manual;var self=this,t=(typeof token=='number')?'filter':token;if(this.tokensMap[t]===undefined){throw'Invalid character "'+token+'" in the logic!';}
var $token=this.getTemplate('logicToken_'+this.tokensMap[t]).data('token',token),$open=$();if(t=='filter'){$token.html(token);}
var $li=$('<li class="jcsdl-logic-token-wrap" />').html($token).appendTo(this.$gui);this.$gui.width(this.$gui.width()+$li.outerWidth(true));if(token==')'&&manual){$open=this.getTemplate('logicToken_bracketOpen').data('token','(');var tokens=this.getGuiTokens().reverse(),pos=tokens.length,level=-1,logic=null;$.each(tokens,function(i,token){if(token==')')level++;else if(token=='(')level--;if(level==0&&$.inArray(token,['&','|'])>=0){if(logic!==null&&token!==logic){pos=i;return false;}
logic=token;}});var $before=this.$gui.children().eq(tokens.length-pos),$openLi=$('<li class="jcsdl-logic-token-wrap" />').html($open).insertBefore($before);this.$gui.width(this.$gui.width()+$openLi.outerWidth(true));}
this.updateFromGui();this.adjustGui();if(scroll){this.scrollGuiToToken($token);}
$token.click(function(ev){ev.preventDefault();ev.target.blur();if($token.data('token')=='&'){$token.data('token','|').html('OR');}else if($token.data('token')=='|'){$token.data('token','&').html('AND');}
self.updateFromGui();});$token.add($open).find('.jcsdl-delete-token').click(function(ev){ev.preventDefault();ev.target.blur();ev.stopPropagation(true);self.deleteGuiToken($token);});$token.filter('.filter').hover(function(ev){self.gui.highlightFilter($(this).data('token'));},function(ev){self.gui.highlightFilter($(this).data('token'),false);});},deleteGuiFilterToken:function(filterId){filterId=parseInt(filterId);var $filter=$(),$operator=$();this.$gui.children().each(function(){var $li=$(this);if(parseInt($li.find('.jcsdl-logic-token').data('token'))===filterId){$filter=$li;return false;}});if(!$filter.length)return false;while($filter.prev().find('.jcsdl-logic-token').data('token')=='('&&$filter.next().find('.jcsdl-logic-token').data('token')==')'){$filter.prev().remove();$filter.next().remove();}
if($filter.prev().find('.jcsdl-logic-token.operator').length){$operator=$filter.prev();}else if($filter.next().find('.jcsdl-logic-token.operator').length){$operator=$filter.next();}
$filter.remove();$operator.remove();this.updateFromGui();},deleteGuiToken:function($token){var $li=($token.is('.jcsdl-logic-token'))?$token.closest('li.jcsdl-logic-token-wrap'):$token;if(!$li.is('li.jcsdl-logic-token-wrap'))return false;var $token=$li.find('.jcsdl-logic-token');if($token.is('.operator'))return false;if($token.is('.filter')){var filterId=$token.data('token'),exists=false;$.each(this.gui.filters,function(i,filter){if(parseInt(filter.id)==parseInt(filterId)){exists=true;return false;}});if(exists)return false;}else if($token.is('.bracket')){var tokens=this.getGuiTokens(),pos=this.$gui.children().index($li),found=null,level=0,onLevel=0,searching=')',lvlIncr='(',lvlDecr=')';if($token.data('token')==')'){tokens=tokens.reverse();pos=tokens.length-1-pos;searching='(';lvlIncr=')';lvlDecr='(';}
$.each(tokens,function(i,t){if(i==pos){onLevel=level;return true;}
if(onLevel!==null&&level==onLevel&&i>pos&&t==searching){found=(searching=='(')?tokens.length-1-i:i;return false;}
if(t==lvlIncr)level++;else if(t==lvlDecr)level--;});if(found!==null){var $found=this.$gui.children().filter('.jcsdl-logic-token-wrap').eq(found);this.$gui.width(this.$gui.width()-$found.outerWidth(true));$found.remove();}}
this.$gui.width(this.$gui.width()-$li.outerWidth(true));$li.remove();this.updateFromGui();this.adjustGui();},_adjustGuiTimeout:null,adjustGui:function(){var self=this,width=0;this.$gui.children().each(function(){width+=parseInt($(this).outerWidth(true));});this.$gui.width(width);clearTimeout(this._adjustGuiTimeout);this._adjustGuiTimeout=setTimeout(function(){var width=self.$gui.width(),containerWidth=self.$guiContainer.width();if(width>containerWidth){self.$guiRight.removeClass('off');}else{self.$guiLeft.add(self.$guiRight).addClass('off');self.scrollGuiToStart();}},50);},scrollGui:function(dir,speed){speed=(speed==undefined)?50:speed;var boundary=-1*Math.max(0,this.$gui.width()-this.$guiContainer.width()),pos=0,self=this;if(typeof dir==='number'){pos=dir;}else{var offset=(dir=='right')?-30:30;pos=parseInt(this.$gui.css('left'))+offset;}
pos=Math.max(Math.min(0,pos),boundary);this.$gui.stop(true,true).animate({left:pos},speed,function(){self.$guiLeft[pos==0?'addClass':'removeClass']('off');self.$guiRight[pos==boundary?'addClass':'removeClass']('off');});},scrollGuiToStart:function(){this.scrollGui(0);},scrollGuiToEnd:function(){this.scrollGuiToToken(this.$gui.children().last());},scrollGuiToToken:function($token){$token=($token.is('.jcsdl-logic-token'))?$token.closest('li.jcsdl-logic-token-wrap'):$token;if(!$token.is('li.jcsdl-logic-token-wrap'))return false;var offset=-1*$token.position().left,pos=(parseInt(this.$gui.css('left'))<offset)?offset-60:offset+60;this.scrollGui(offset+140);},initManualInput:function($input){var self=this;var updateTimeout=null;$input.keyup(function(ev){clearTimeout(updateTimeout);updateTimeout=setTimeout(function(){var str=$input.val();try{if(self.validate(str)){self.clearErrors();self.logicString=str;}}catch(e){self.showError(e,true);}},500);});$input.keydown(function(ev){var k=ev.which,s=ev.shiftKey;if(k==8||(k>=37&&k<=40)||k==46||(k>=48&&k<=57&&!s)||(k>=96&&k<=105)||k==219||(k==57&&s)||k==221||(k==48&&s)||k==32||(k==55&&s)||(k==220&&s)){return;}else{ev.preventDefault();return;}});$input.keypress(function(ev){if(ev.which==13){ev.preventDefault();}});return $input;},setManualString:function(logicString){logicString=logicString||this.logicString;var tokens=(typeof logicString==='string'||typeof logicString==='number')?this.tokenize(logicString):logicString;this.$manualInput.val(tokens.join(' '));},getManualString:function(){return this.$manualInput.val();},setLogic:function(logic){this.logic=($.inArray(logic,[this.AND,this.OR])>-1)?logic:this.ADVANCED;this.$logicOptions.filter('[data-logic="'+this.logic+'"]').click();var logicString='';if(this.logic==this.ADVANCED){logicString=logic;}else{var ids=[];$.each(this.gui.filters,function(i,filter){ids.push(filter.id);});logicString=ids.join(this.logic==this.OR?'|':'&');}
this.setLogicString(logicString);},getLogic:function(){return this.logic;},setLogicString:function(logicString){this.logicString=''+logicString;this.setGuiString(logicString);this.setManualString(logicString);},appendFilterToLogicString:function(filterId,logic){logic=logic||this.logic;logic=(logic==this.OR)?'|':'&';var logicString=(this.logicString.length)?this.logicString+logic+filterId:filterId;this.setLogicString(logicString);},getLogicString:function(){return(this.logic==this.ADVANCED)?this.logicString:this.logic;}};});
;JCSDL.Loader.addComponent(function($,undefined){this.GUI=function(el,cfg){var $el=$(el);if($el.length==0)return false;this.$el=$el.eq(0);var self=this;this.$container=null;this.config=$.extend(true,{animate:200,cancelButton:true,saveButton:null,googleMapsApiKey:'',mapsOverlay:{strokeWeight:0,fillColor:'#7585dd',fillOpacity:0.5},mapsMarker:'jcsdl/img/maps-marker.png',hideTargets:[],definition:{},save:function(code){},saveError:function(error){},cancel:function(){this.hide();},invalidJCSDL:function(code){},logicChange:function(logic){},viewModeChange:function(mode){},filterNew:function(){},filterEdit:function(filter){},filterDelete:function(filter){},filterSave:function(filter){},filterCancel:function(filter){},targetSelect:function(target){},operatorSelect:function(operator){},caseSensitivityChange:function(on){},targetHelpUrl:function(target,fieldInfo){if(fieldInfo.helpUrl){return fieldInfo.helpUrl;}
target=target.replace(/\./g,'-');return this.definition.targetHelpJsonpSource.replace(/\{target\}/g,target);}},cfg);this.definition=$.extend(true,JCSDLDefinition,this.config.definition);this.parser=new JCSDL.Parser(this);this.logic=null;this.inputs=new JCSDL.GUIInputs(this);this.filters=[];this.currentFilterIndex=null;this.$mainView=null;this.$filtersList=null;this.init();};this.GUI.prototype={init:function(){var self=this;this.filters=[];this.currentFilterIndex=null;this.$mainView=this.getTemplate('editor');this.$filtersList=this.$mainView.find('.jcsdl-filters-list');this.$container=this.getTemplate('container');this.$container.html(this.$mainView);this.$el.html(this.$container);this.$saveButton=this.$mainView.find('.jcsdl-editor-save');this.$cancelButton=this.$mainView.find('.jcsdl-editor-cancel');if(this.config.saveButton&&(typeof(this.config.saveButton)=='object'||typeof(this.config.saveButton)=='string')){this.$saveButton.remove();this.$saveButton=$(this.config.saveButton);}
if(this.config.cancelButton&&(typeof(this.config.cancelButton)=='object'||typeof(this.config.cancelButton)=='string')){this.$cancelButton.remove();this.$cancelButton=$(this.config.cancelButton);}
if(!this.config.cancelButton){this.$cancelButton.hide();}
if($.browser.msie){this.$container.addClass('msie');}
this.logic=new JCSDL.GUILogic(this,JCSDL.GUILogic.prototype.AND);this.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();var $item=$(this),mode=$item.attr('data-mode');self.$filtersList.removeClass('expanded collapsed');self.$filtersList.addClass(mode);self.$mainView.find('.jcsdl-mainview-mode .jcsdl-mainview-mode-option').removeClass('active');$item.addClass('active');self.trigger('viewModeChange',[mode]);});this.$mainView.find('.jcsdl-add-filter').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.showFilterEditor();});this.$saveButton.unbind('.jcsdl').bind('click.jcsdl touchstart.jcsdl',function(ev){ev.preventDefault();ev.target.blur();try{var code=self.returnJCSDL();self.trigger('save',[code]);}catch(e){self.showError(e);var message=(e instanceof JCSDL.LogicValidationException)?e.message:e;self.trigger('saveError',[message]);}});this.$cancelButton.unbind('.jcsdl').bind('click.jcsdl touchstart.jcsdl',function(ev){ev.preventDefault();ev.target.blur();self.trigger('cancel');});},reset:function(){this.init();},loadJCSDL:function(code){this.init();var self=this;try{var parsed=this.parser.parseJCSDL(code);this.filters=parsed.filters;if(this.filters.length>=2){this.logic.toggleButtons();}
this.logic.setLogic(parsed.logic);}catch(e){var errorCode=(e instanceof JCSDL.ValidationException)?e.code:code;this.showError(e,errorCode);this.trigger('invalidJCSDL',[errorCode]);return false;}
$.each(this.filters,function(i,filter){var $filterRow=self.createFilterRow(filter);$filterRow.appendTo(self.$filtersList);});if(this.filters.length){this.$mainView.find('.jcsdl-footer').show();}
if(this.config.cancelButton){this.$cancelButton.show();}},returnJCSDL:function(){return this.parser.getJCSDLForFilters(this.filters,this.logic.getLogicString());},adjust:function(){if(this.editor){this.editor.adjust();}},hide:function(){this.$container.hide();},show:function(){this.$container.show();},trigger:function(name,data){data=data||[];this.$el.trigger(name.toLowerCase(),data);if(typeof(this.config[name])=='function'){return this.config[name].apply(this,data);}
return null;},showFilterEditor:function(filter,filterIndex){var self=this;this.$mainView.hide();this.editor=new JCSDL.GUIFilterEditor(this,this.$container,filter);if(filter!==undefined&&filter){this.currentFilterIndex=filterIndex;self.trigger('filterEdit',[filter]);}else{self.trigger('filterNew');var lastFilter=this.filters[this.filters.length-1];if(lastFilter!==undefined){this.editor.getView().find('.jcsdl-filter-target .target-'+lastFilter.target+':visible').trigger('jcsdlclick');}}},hideFilterEditor:function(callback){callback=(typeof callback=='function')?callback:$.noop;var self=this;this.currentFilterIndex=null;this.editor.getView().fadeOut(this.config.animate,function(){$(this).remove();self.$mainView.show();self.editor=null;callback.apply(self,[]);});},didSubmitFilter:function(filterInfo){var self=this,callback=$.noop,id=(this.currentFilterIndex!==null)?this.filters[this.currentFilterIndex].id:this.createFilterId(),filter=this.parser.createFilter(filterInfo.target,filterInfo.path,filterInfo.operator,filterInfo.value,filterInfo.additional,id),$filterRow=this.createFilterRow(filter);if(this.currentFilterIndex!==null){this.$filtersList.find('.jcsdl-filter.filter-'+filter.id).replaceWith($filterRow);this.filters[this.currentFilterIndex]=filter;}else{$filterRow.appendTo(this.$filtersList);this.filters.push(filter);callback=function(){self.logic.appendFilterToLogicString(filter.id);};}
if(this.filters.length){this.$mainView.find('.jcsdl-footer').fadeIn(this.config.animate);}
if(this.filters.length>=2){this.logic.toggleButtons();}
this.hideFilterEditor(callback);this.trigger('filterSave',[filter]);},deleteFilter:function(index){var filter=this.filters[index];this.trigger('filterDelete',[filter]);this.$filtersList.find('.jcsdl-filter.filter-'+filter.id).remove();this.filters.splice(index,1);this.logic.deleteGuiFilterToken(filter.id);if(!this.filters.length){this.$mainView.find('.jcsdl-footer').fadeOut(this.config.animate);}
if(this.filters.length<2){this.logic.toggleButtons(false);}},showError:function(error,code){if(error instanceof TypeError)throw error;this.clearErrors();if(error instanceof JCSDL.LogicValidationException){return this.logic.showError(error);}
var message=(error instanceof JCSDL.ValidationException)?error.message:error;var $error=this.getTemplate('error');$error.find('span').html(message);$error.insertBefore(this.$mainView.find('.jcsdl-footer'));$error.hide().fadeIn();if(console!==undefined){console.error(message,arguments);}
$error.animateIntoView(this.config.animate);},clearErrors:function(){this.$mainView.find('.jcsdl-error').remove();},createFilterRow:function(filter){var self=this,$filterRow=this.getTemplate('filter');$filterRow.addClass('filter-'+filter.id).data('filterId',filter.id).find('.jcsdl-filter-info.id').html(filter.id);var targetInfo=this.parser.getTargetInfo(filter.target),$target=this.getTemplate('filterTarget').addClass('selected target-'+filter.target).html(targetInfo.name);$filterRow.find('.target').html($target);var currentPath=[];$.each(filter.fieldPath,function(i,field){currentPath.push(field);var fieldInfo=self.parser.getFieldInfo(filter.target,currentPath),$field=self.getTemplate('filterField').addClass('selected icon-'+self.getIconForField(field,fieldInfo)).html(fieldInfo.name);$filterRow.find('.jcsdl-filter-info.field').append($field);});var field=this.parser.getFieldInfo(filter.target,currentPath);var $operator=this.getTemplate('filterOperator').addClass('operator-'+filter.operator+' icon-'+filter.operator+' selected').attr('title',this.definition.operators[filter.operator].description).html(this.definition.operators[filter.operator].code.escapeHtml()).tipsy({gravity:'s',offset:9});$filterRow.find('.operator').html($operator);if(filter.cs){var $cs=this.getTemplate('filterOperator').addClass('operator-cs icon-cs selected').attr('title','Case Sensitive').html('case sensitive').tipsy({gravity:'s',offset:9});$filterRow.find('.jcsdl-filter-info.operator').append($cs);$cs.tipsy('show');}
if(filter.operator!=='exists'){var $value=null,isGeo=($.inArray(filter.operator,['geo_box','geo_polygon','geo_radius'])>=0),input=(isGeo)?filter.operator:field.input;if(isGeo){var $input=this.getTemplate('filterFieldInput').insertAfter($filterRow.find('.jcsdl-filter-info.field')).find('.jcsdl-filter-field-input').addClass('selected icon-'+filter.operator);$operator.remove();}
if(this.inputs[input]&&typeof(this.inputs[input].displayValue)=='function'){$value=this.inputs.exec(input,'displayValue',[field,filter.value,filter]);}else{$value=this.getTemplate('filterValue').html(filter.value.truncate(50).escapeHtml());}
$filterRow.find('.value').addClass('input-'+input).html($value);$filterRow.find('.operator').addClass('input-'+input);}else{$filterRow.find('.value').remove();}
$filterRow.data('filter',filter);$filterRow.find('.edit').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.showFilterEditor(filter,self.getFilterIndexByElement($filterRow));});$filterRow.find('.delete').bind('click touchstart',function(ev){ev.preventDefault();ev.target.blur();self.deleteFilter(self.getFilterIndexByElement($filterRow));});return $filterRow;},createFilterId:function(){var ids=[],i=1;$.each(this.filters,function(i,filter){ids.push(parseInt(filter.id));});while($.inArray(i,ids)>=0)i++;return i;},highlightFilter:function(filterId,on){on=(on===undefined)?true:false;this.$filtersList.find('.filter-'+filterId)[on?'addClass':'removeClass']('on');},getTemplate:function(name){if(JCSDL.GUITemplates[name]!==undefined){return JCSDL.GUITemplates[name].clone();}
return $();},getIconForField:function(field,fieldInfo){return(fieldInfo.icon!==undefined)?fieldInfo.icon:field;},getFilterIndexByElement:function($filterRow){return this.$filtersList.find('.jcsdl-filter').index($filterRow);}};$.fn.jcsdlGui=function(options){function get($el){var gui=$el.data('jcsdlGui');if(!gui){gui=new JCSDL.GUI($el,options);$el.data('jcsdlGui',gui);}
return gui;}
if(typeof(options)=='string'){if($.inArray(options,['loadJCSDL','adjust'])>=0){var argmns=[];$.each(arguments,function(i,arg){if(i==0)return true;argmns.push(arg);});this.each(function(){var gui=get($(this));gui[options].apply(gui,argmns);});}
return this;}
this.each(function(){get($(this));});return this;};JCSDLGui=function($el,o){return new JCSDL.GUI($el,o);}});
;(function(){if(!window.jQuery){var h=document.getElementsByTagName('head'),s=document.createElement('script');s.src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js';s.type='text/javascript';h[0].appendChild(s);JCSDL.Loader.timeout(true);}else{JCSDL.Loader.load();}})();
